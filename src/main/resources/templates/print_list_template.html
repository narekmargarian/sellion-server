<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${title}">Реестр операций</title>
    <style>
        body { font-family: 'Inter', sans-serif; font-size: 11px; margin: 20px; color: #000; }
        .header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 10px; }
        .main-table { width: 100%; border-collapse: collapse; }
        .main-table th, .main-table td { border: 1px solid #000; padding: 6px; text-align: left; }
        .main-table th { background: #f0f0f0; text-transform: uppercase; }
        .total-row { font-weight: bold; background: #f9f9f9; }
        .text-right { text-align: right; }
        .col-id { width: 40px; text-align: center; } /* Новый класс для центрирования номера */


        @media print {
    @page {
        margin: 0; /* Убирает отступы, где печатаются колонтитулы */
    }
    body {
        margin: 1.5cm; /* Добавляет отступ уже самому контенту, чтобы текст не прилипал к краю листа */
    }
}

    </style>
</head>
<body>
<div class="header">
    <h1 th:text="${title}" style="margin: 0; font-size: 18px;">РЕЕСТР</h1>
    <p style="margin: 5px 0;">Дата печати: <span th:text="${#temporals.format(currentDateTime, 'dd.MM.yyyy HH:mm')}"></span></p>
</div>

<table class="main-table">
    <thead>
    <tr>
        <th class="col-id">№</th> <!-- Изменили заголовок с ID на № -->
        <th style="width: 110px;">Дата</th>
        <th>Магазин</th>
        <th class="text-right" style="width: 100px;">Сумма (֏)</th>
        <th>Комментарий/Причина</th>
    </tr>
    </thead>
    <tbody>
    <!-- Используем "stat" для получения индекса цикла -->
    <tr th:each="op, stat : ${operations}">
        <td class="col-id" th:text="${stat.index + 1}">1</td> <!-- Выводим порядковый номер -->

        <!-- Универсальный вывод даты -->
        <td th:text="${op.createdAt != null ? #temporals.format(op.createdAt, 'dd.MM.yyyy HH:mm') : '---'}"></td>


        <td th:text="${op.shopName}" style="font-weight: bold;"></td>

        <td class="text-right" th:text="${op.totalAmount != null ? #numbers.formatInteger(op.totalAmount, 1, 'WHITESPACE') : '0'}"></td>

        <td>
            <!-- Логика для ВОЗВРАТА -->
            <th:block th:if="${title.contains('ВОЗВРАТ')}">
                <span th:text="${op.returnReason != null ? op.returnReason.displayName : '---'}"></span>
            </th:block>

            <!-- Логика для ЗАКАЗА -->
            <th:block th:if="${title.contains('ЗАКАЗ')}">
                <span th:text="${(op.comment != null && !op.comment.isEmpty()) ? op.comment : (op.paymentMethod != null ? op.paymentMethod.displayName : '---')}"></span>
            </th:block>
        </td>
    </tr>
    </tbody>
    <tfoot>
    <tr class="total-row">
        <td colspan="3" class="text-right">ИТОГО К ОПЛАТЕ:</td>
        <td class="text-right" th:text="${#numbers.formatInteger(finalTotal, 1, 'WHITESPACE') + ' ֏'}"></td>
        <td></td>
    </tr>
    </tfoot>
</table>
</body>
</html>
