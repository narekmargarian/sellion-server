<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Sellion ERP 2026</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com" rel="stylesheet">

    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<div class="sidebar">
    <div class="brand">SELLION 2026</div>
    <div sec:authorize="hasRole('ADMIN')" onclick="showTab('tab-main')" class="nav-link" id="btn-main">
        <i class="bi bi-speedometer2"></i> –û–±–∑–æ—Ä
    </div>

    <div onclick="showTab('tab-orders')" class="nav-link" id="btn-orders"><i class="bi bi-cart"></i> –ó–∞–∫–∞–∑—ã</div>
    <div onclick="showTab('tab-returns')" class="nav-link" id="btn-returns"><i class="bi bi-arrow-counterclockwise"></i>
        –í–æ–∑–≤—Ä–∞—Ç—ã
    </div>
    <div onclick="showTab('tab-delivery')" class="nav-link" id="btn-delivery"><i class="bi bi-truck"></i> –î–æ—Å—Ç–∞–≤–∫–∞</div>
    <div onclick="showTab('tab-clients')" class="nav-link" id="btn-clients"><i class="bi bi-people"></i> –ö–ª–∏–µ–Ω—Ç—ã</div>

    <div sec:authorize="hasRole('ADMIN')" onclick="showTab('tab-managers')" class="nav-link" id="btn-managers">
        <i class="bi bi-person-badge-fill"></i> –ú–µ–Ω–µ–¥–∂–µ—Ä—ã
    </div>

    <div onclick="showTab('tab-products')" class="nav-link" id="btn-products"><i class="bi bi-box-seam"></i> –°–∫–ª–∞–¥</div>

    <div sec:authorize="hasAnyRole('ADMIN','ACCOUNTANT')" onclick="showTab('tab-invoices')" class="nav-link"
         id="btn-invoices">
        <i class="bi bi-file-earmark-text"></i> –°—á–µ—Ç–∞ / –û–ø–ª–∞—Ç–∞
    </div>
    <div sec:authorize="hasAnyRole('ADMIN','ACCOUNTANT')" onclick="showTab('tab-reports')" class="nav-link"
         id="btn-reports">
        <i class="bi bi-graph-up"></i> –û—Ç—á–µ—Ç—ã
    </div>

    <div sec:authorize="hasRole('ADMIN')" onclick="showTab('tab-imports')" class="nav-link" id="btn-imports"><i
            class="bi bi-cloud-arrow-up"></i> –ò–º–ø–æ—Ä—Ç
    </div>
    <div sec:authorize="hasRole('ADMIN')" onclick="showTab('tab-users')" class="nav-link" id="btn-users"><i
            class="bi bi-shield-lock"></i> –ü–µ—Ä—Å–æ–Ω–∞–ª
    </div>
    <div sec:authorize="hasRole('ADMIN')" onclick="showTab('tab-settings')" class="nav-link" id="btn-settings"><i
            class="bi bi-gear"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    </div>


    <form id="logout-form" th:action="@{/logout}" method="post" style="margin-top:auto; padding:20px;">
        <button type="button"
                onclick="showConfirmModal('–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤—ã—Ö–æ–¥', '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∫–∏–Ω—É—Ç—å —Å–∏—Å—Ç–µ–º—É?', () => document.getElementById('logout-form').submit())"
                style="width:100%; background:#ef4444; color:white; border:none; padding:10px; border-radius:8px; cursor:pointer; font-weight:700;">
            –í–´–•–û–î
        </button>
    </form>

</div>

<div class="main">
    <div class="scroll-area">

        <div id="tab-orders" class="tab-pane">
            <div class="summary-card">
                <div class="summary-item">
                    <small>–ó–∞–∫–∞–∑–æ–≤ –≤—Å–µ–≥–æ:</small>
                    <span th:text="${totalOrdersCount ?: 0}">0</span>
                </div>
                <div class="summary-item">
                    <small>–û–±—â–∞—è —Å—É–º–º–∞:</small>
                    <span class="price-up"
                          th:text="${(totalOrdersSum ?: 0) == 0 ? '0 ÷è' : #numbers.formatInteger(totalOrdersSum, 1, 'WHITESPACE') + ' ÷è'}">0 ÷è</span>
                </div>
            </div>

            <div class="filter-bar">
                <input type="text" id="search-orders" onkeyup="filterTable('search-orders', 'orders-table-body')"
                       placeholder="–ü–æ–∏—Å–∫ –ø–æ –º–∞–≥–∞–∑–∏–Ω—É..." class="form-control w-25">

                <form method="get" th:action="@{/admin}" class="d-inline-flex gap-2 align-items-center">
                    <input type="hidden" name="activeTab" value="tab-orders">
                    <small>–°:</small>
                    <input type="date" name="orderStartDate" class="form-control" th:value="${orderStartDate}">
                    <small>–ü–æ:</small>
                    <input type="date" name="orderEndDate" class="form-control" th:value="${orderEndDate}">
                    <select name="orderManagerId" onchange="this.form.submit()" class="form-select">
                        <option value="">–í—Å–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã</option>
                        <option th:each="m : ${managers}" th:value="${m}" th:text="${m}"
                                th:selected="${m == selectedOrderManager}"></option>
                    </select>
                    <button type="submit" class="btn-primary" title="–û–±–Ω–æ–≤–∏—Ç—å">‚ü≥</button>
                    <button type="button" class="btn-primary" onclick="printSelectedOperations('order')"
                            title="–ü–µ—á–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö">‚éô
                    </button>
                </form>
                <button class="btn-primary" onclick="openCreateOrderModal()" title="–ù–æ–≤—ã–π –∑–∞–∫–∞–∑">+</button>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th style="width: 40px;">
                            <input type="checkbox" onclick="toggleSelectAll('order-print-check', this)"
                                   style="cursor:pointer;">
                        </th>
                        <th>–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</th>
                        <th>–ú–µ–Ω–µ–¥–∂–µ—Ä</th>
                        <th>–ú–∞–≥–∞–∑–∏–Ω</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–î–æ—Å—Ç–∞–≤–∫–∞</th>
                        <th>–ê–≤—Ç–æ</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                    </tr>
                    </thead>
                    <tbody id="orders-table-body">
                    <tr th:each="o : ${orders}" th:data-id="${o.id}"
                        onclick="if(!event.target.closest('button, input')){ openOrderDetails(this.getAttribute('data-id')) }">
                        <td onclick="event.stopPropagation()">
                            <input type="checkbox" class="order-print-check" th:value="${o.id}">
                        </td>

                        <td class="js-date-format" th:text="${o.createdAt}"></td>
                        <td th:text="${o.managerId}" style="font-weight:600; color:var(--accent);"></td>
                        <td th:text="${o.shopName}" style="font-weight:700;"></td>
                        <td class="price-up"
                            th:text="${o.totalAmount != null ? #numbers.formatInteger(o.totalAmount, 1, 'WHITESPACE') + ' ÷è' : '0 ÷è'}"></td>

                        <td class="js-date-format" th:text="${o.deliveryDate}"></td>

                        <td><b th:text="${o.carNumber ?: '---'}" style="color: #64748b;"></b></td>

                        <td>
                            <th:block th:if="${o.shopName == '–°–ü–ò–°–ê–ù–ò–ï'}">
                                <span class="badge bg-secondary">–°–ü–ò–°–ê–ù–û</span>
                            </th:block>
                            <th:block th:unless="${o.shopName == '–°–ü–ò–°–ê–ù–ò–ï'}">
                        <span th:class="|badge ${o.invoiceId != null ? 'bg-success' : (o.status.name() == 'RESERVED' ? 'bg-info' : 'bg-primary')}|"
                              th:text="${o.invoiceId != null ? '–ü–†–û–í–ï–†–ï–ù–û' : (o.status.name() == 'RESERVED' ? '–í —Ä–µ–∑–µ—Ä–≤–µ' : '–ù–æ–≤—ã–π')}">
                        </span>
                            </th:block>
                            <br/>
                            <small class="text-muted"
                                   th:text="${o.paymentMethod != null ? o.paymentMethod.displayName : ''}"></small>
                        </td>

                        <td onclick="event.stopPropagation()">
                            <div style="display: flex; gap: 5px;">
                                <th:block th:if="${o.shopName != '–°–ü–ò–°–ê–ù–ò–ï'}">
                                    <th:block th:if="${o.invoiceId == null}">
                                        <form th:action="@{'/admin/invoices/create-from-order/' + ${o.id}}"
                                              method="post">
                                            <button type="submit" class="btn-primary"
                                                    style="padding:5px 10px; font-size:11px; background:#10b981;">–°—á–µ—Ç
                                            </button>
                                        </form>
                                        <button type="button" class="btn-primary"
                                                th:onclick="'showConfirmModal(\'–£–¥–∞–ª–µ–Ω–∏–µ\', \'–£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑?\', () => cancelOrder(' + ${o.id} + '))'"
                                                style="padding:5px 10px; font-size:11px; background:#ef4444;">‚ùå
                                        </button>
                                    </th:block>
                                    <span th:if="${o.invoiceId != null}" class="badge bg-light text-dark"
                                          style="border:1px solid #ccc; padding: 7px;">–°—á–µ—Ç ‚Ññ[[${o.invoiceId}]]</span>
                                </th:block>

                                <th:block th:if="${o.shopName == '–°–ü–ò–°–ê–ù–ò–ï'}">
                                    <small class="text-muted">–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Å–∫–ª–∞–¥–∞</small>
                                </th:block>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="pagination-wrapper" th:if="${totalPages > 1}"
                 style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                <a th:href="@{/admin(activeTab='tab-orders', page=${currentPage - 1}, orderStartDate=${orderStartDate}, orderEndDate=${orderEndDate})}"
                   th:if="${currentPage > 0}" class="btn-ghost">‚Üê –ù–∞–∑–∞–¥</a>
                <span style="align-self: center; font-weight: 700;">
            –°—Ç—Ä–∞–Ω–∏—Ü–∞ <span th:text="${currentPage + 1}"></span> –∏–∑ <span th:text="${totalPages}"></span>
        </span>
                <a th:href="@{/admin(activeTab='tab-orders', page=${currentPage + 1}, orderStartDate=${orderStartDate}, orderEndDate=${orderEndDate})}"
                   th:if="${currentPage < totalPages - 1}" class="btn-ghost">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
            </div>
        </div>


        <div id="tab-invoices" class="tab-pane">
            <div class="summary-card" style="background: #f0fdf4; border-color: #bbf7d0; display: flex; gap: 20px;">
                <div class="summary-item">
                    <small>–û–±—â–∏–π –¥–æ–ª–≥ –ø–æ —Å—á–µ—Ç–∞–º:</small><br>
                    <span class="price-down"
                          th:text="${(totalInvoiceDebt ?: 0) == 0 ? '0 ÷è' : #numbers.formatInteger(totalInvoiceDebt, 1, 'WHITESPACE') + ' ÷è'}">
                    </span>
                </div>
                <div class="summary-item">
                    <small>–û–ø–ª–∞—á–µ–Ω–Ω—ã–π –¥–æ–ª–≥ –ø–æ —Å—á–µ—Ç–∞–º:</small><br>
                    <span class="price-up"
                          th:text="${totalPaidSum == null ? '0 ÷è' : #numbers.formatInteger(totalPaidSum, 1, 'WHITESPACE') + ' ÷è'}">
                    </span>
                </div>
            </div>

            <div class="filter-bar">
                <input type="text" id="search-invoices" onkeyup="filterTable('search-invoices', 'invoices-table-body')"
                       placeholder="–ü–æ–∏—Å–∫..." class="form-control" style="width: 150px;">

                <select id="filter-invoice-manager" class="form-select" style="width: 150px;"
                        onchange="filterInvoices()">
                    <option value="">–í—Å–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã</option>
                    <option th:each="m : ${managers}" th:value="${m}" th:text="${m}"></option>
                </select>

                <select id="filter-invoice-status" class="form-select" style="width: 150px;"
                        onchange="filterInvoices()">
                    <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    <option value="–û–ø–ª–∞—á–µ–Ω">–û–ø–ª–∞—á–µ–Ω</option>
                    <option value="–ß–∞—Å—Ç–∏—á–Ω–æ">–ß–∞—Å—Ç–∏—á–Ω–æ</option>
                    <option value="–ù–µ –û–ø–ª–∞—á–µ–Ω">–ù–µ –û–ø–ª–∞—á–µ–Ω</option>
                </select>

                <div class="d-flex gap-1">
                    <input type="date" id="inv-date-start" class="form-control" style="width: 130px;">
                    <input type="date" id="inv-date-end" class="form-control" style="width: 130px;">
                </div>

                <button class="btn-primary" onclick="printManagerDebts()" style="background: #1e293b;">‚éô –õ–∏—Å—Ç –¥–æ–ª–≥–æ–≤
                </button>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th>‚Ññ –°—á–µ—Ç–∞</th>
                        <th>–ú–∞–≥–∞–∑–∏–Ω</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–û–ø–ª–∞—á–µ–Ω–æ</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                    </tr>
                    </thead>
                    <tbody id="invoices-table-body">

                    <tr th:each="inv : ${invoices}" th:data-manager="${inv.managerId}">

                        <td th:text="${inv.invoiceNumber}"></td>
                        <td th:text="${inv.shopName}" style="font-weight:700;"></td>
                        <td th:text="${#numbers.formatInteger(inv.totalAmount, 1, 'WHITESPACE') + ' ÷è'}"></td>
                        <td class="price-up"
                            th:text="${#numbers.formatInteger(inv.paidAmount, 1, 'WHITESPACE') + ' ÷è'}"></td>

                        <td>
                            <span th:with="isFullyPaid=(${inv.paidAmount} >= ${inv.totalAmount}), isPartial=(${inv.paidAmount} > 0 and ${inv.paidAmount} < ${inv.totalAmount})"

                                  th:class="|badge ${isFullyPaid ? 'bg-success text-white' : (isPartial ? 'bg-info text-dark' : 'bg-warning text-dark')}|"

                                  th:text="${isFullyPaid ? '–û–ø–ª–∞—á–µ–Ω' : (isPartial ? '–ß–∞—Å—Ç–∏—á–Ω–æ' : '–ù–µ –û–ø–ª–∞—á–µ–Ω')}">
                            </span>
                        </td>


                        <td>
                            <div style="display: flex; gap: 5px;">
                                <button class="btn-primary" style="padding:5px;"
                                        th:onclick="'openPaymentModal(' + ${inv.id} + ')'">üí≥ –û–ø–ª–∞—Ç–∞
                                </button>
                                <button class="btn-primary" style="background:#64748b; padding:5px;"
                                        th:onclick="'printInvoiceInline(' + ${inv.id} + ')'">
                                    üñ® –ü–µ—á–∞—Ç—å
                                </button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>


        <div id="tab-returns" class="tab-pane">
            <div class="summary-card" style="background: #fff1f2; border-color: #fecdd3;">
                <div class="summary-item">
                    <small>–í–æ–∑–≤—Ä–∞—Ç–æ–≤ –≤—Å–µ–≥–æ:</small>
                    <span th:text="${totalReturnsCount ?: 0}">0</span>
                </div>
                <div class="summary-item">
                    <small>–°—É–º–º–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤:</small>
                    <span class="price-down"
                          th:text="${(totalReturnsSum ?: 0) == 0 ? '0 ÷è' : #numbers.formatInteger(totalReturnsSum, 1, 'WHITESPACE') + ' ÷è'}">0 ÷è</span>
                </div>
            </div>

            <div class="filter-bar">
                <input type="text" id="search-returns" onkeyup="filterTable('search-returns', 'returns-table-body')"
                       placeholder="–ü–æ–∏—Å–∫ –ø–æ –≤–æ–∑–≤—Ä–∞—Ç—É..." class="form-control w-25">

                <form method="get" th:action="@{/admin}" class="d-inline-flex gap-2 align-items-center">
                    <input type="hidden" name="activeTab" value="tab-returns">

                    <small>–°:</small>
                    <input type="date" name="returnStartDate" class="form-control" th:value="${returnStartDate}">
                    <small>–ü–æ:</small>
                    <input type="date" name="returnEndDate" class="form-control" th:value="${returnEndDate}">

                    <select name="returnManagerId" onchange="this.form.submit()" class="form-select">
                        <option value="">–í—Å–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã</option>
                        <option th:each="m : ${managers}" th:value="${m}" th:text="${m}"
                                th:selected="${m == selectedReturnManager}"></option>
                    </select>

                    <button type="submit" class="btn-primary" title="–û–±–Ω–æ–≤–∏—Ç—å">‚ü≥</button>

                    <button type="button" class="btn-primary" onclick="printSelectedOperations('return')"
                            title="–ü–µ—á–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö">üñ®Ô∏è
                    </button>
                </form>

                <button class="btn-primary" onclick="openCreateReturnModal()" title="–ù–æ–≤—ã–π –≤–æ–∑–≤—Ä–∞—Ç">+</button>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th style="width: 40px;">
                            <input type="checkbox" onclick="toggleSelectAll('return-print-check', this)"
                                   style="cursor:pointer;">
                        </th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ú–µ–Ω–µ–¥–∂–µ—Ä</th>
                        <th>–ú–∞–≥–∞–∑–∏–Ω</th>
                        <th>–ê–≤—Ç–æ</th>
                        <th>–ü—Ä–∏—á–∏–Ω–∞</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                    </thead>
                    <tbody id="returns-table-body">
                    <tr th:each="r : ${returns}"
                        th:data-id="${r.id}"
                        onclick="openReturnDetails(this.getAttribute('data-id'))"
                        style="cursor:pointer;">

                        <td onclick="event.stopPropagation()">
                            <input type="checkbox" class="return-print-check" th:value="${r.id}"
                                   style="cursor:pointer;">
                        </td>

                        <td class="js-date-format" th:text="${r.createdAt}"></td>
                        <td th:text="${r.managerId}"></td>
                        <td th:text="${r.shopName}"></td>

                        <td><b th:text="${r.carNumber ?: '---'}" style="color: #64748b;"></b></td>

                        <td th:with="rName=${r.returnReason.name()}, isWarehouse=${rName == 'WAREHOUSE' or #strings.contains(rName, 'CORRECTION')}"
                            th:style="${isWarehouse} ? 'color: #059669; font-weight: 800;' : 'color: #dc2626; font-weight: 500;'">

                            <span th:text="${isWarehouse ? 'üîÑ ' : 'üóëÔ∏è '}"></span>
                            <span th:text="${r.returnReason.displayName}"></span>
                        </td>

                        <td class="price-down"
                            th:text="${r.totalAmount != null ? #numbers.formatInteger(r.totalAmount, 1, 'WHITESPACE') + ' ÷è' : '0 ÷è'}"></td>

                        <td>
                            <span class="js-status-translate" th:text="${r.status.name()}"></span>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>


        <div id="tab-clients" class="tab-pane">
            <div class="filter-bar">
                <input type="text" id="search-clients" onkeyup="filterTable('search-clients', 'clients-table-body')"
                       placeholder="–ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ –∏–ª–∏ –∞–¥—Ä–µ—Å–∞..." class="form-control w-25">

                <select id="filter-client-day" onchange="filterTable('filter-client-day', 'clients-table-body')"
                        class="form-select w-25">
                    <option value="">–í—Å–µ –¥–Ω–∏ –º–∞—Ä—à—Ä—É—Ç–∞</option>
                    <option value="–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</option>
                    <option value="–í—Ç–æ—Ä–Ω–∏–∫">–í—Ç–æ—Ä–Ω–∏–∫</option>
                    <option value="–°—Ä–µ–¥–∞">–°—Ä–µ–¥–∞</option>
                    <option value="–ß–µ—Ç–≤–µ—Ä–≥">–ß–µ—Ç–≤–µ—Ä–≥</option>
                    <option value="–ü—è—Ç–Ω–∏—Ü–∞">–ü—è—Ç–Ω–∏—Ü–∞</option>
                    <option value="–°—É–±–±–æ—Ç–∞">–°—É–±–±–æ—Ç–∞</option>
                </select>


                <button class="btn-primary" onclick="openModal('modal-client')">+ –î–æ–±–≤–∏—Ç—å
                </button>
            </div>
            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th>–ú–∞–≥–∞–∑–∏–Ω</th>
                        <th>–ê–¥—Ä–µ—Å</th>
                        <th>–î–æ–ª–≥</th>
                    </tr>
                    </thead>
                    <tbody id="clients-table-body">
                    <tr th:each="c : ${clients}" th:onclick="'openClientDetails(' + ${c.id} + ')'"
                        style="cursor:pointer;">
                        <td th:text="${c.name}" style="font-weight:700;"></td>
                        <td th:text="${c.address}"></td>
                        <td class="price-down" th:text="${#numbers.formatInteger(c.debt, 1, 'WHITESPACE') + ' ÷è'}"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="tab-products" class="tab-pane">
            <div class="filter-bar">
                <input type="text" id="search-products" onkeyup="filterTable('search-products', 'products-table-body')"
                       placeholder="–ü–æ–∏—Å–∫ –ø–æ —Å–∫–ª–∞–¥—É..." class="form-control w-25">
                <button class="btn-primary" onclick="openModal('modal-product-create-new')">+ –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä</button>
                <button class="btn-primary" style="background: #64748b;" onclick="openWriteOffModal()">üóë –°–ø–∏—Å–∞—Ç—å —Ç–æ–≤–∞—Ä
                </button>

            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th style="width: 40%;">–¢–æ–≤–∞—Ä</th>
                        <th>–¶–µ–Ω–∞</th>
                        <th>–û—Å—Ç–∞—Ç–æ–∫</th>
                        <th>–£–ø–∞–∫.</th>
                        <th>–®—Ç—Ä–∏—Ö-–∫–æ–¥</th>
                        <th>–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏</th>
                    </tr>
                    </thead>

                    <tbody id="products-table-body">
                    <tr th:if="${groupedProducts == null or groupedProducts.isEmpty()}">
                        <td colspan="5" style="text-align: center; padding: 30px; color: #94a3b8;">–ù–∞ —Å–∫–ª–∞–¥–µ –ø–æ–∫–∞ –Ω–µ—Ç
                            —Ç–æ–≤–∞—Ä–æ–≤
                        </td>
                    </tr>

                    <th:block th:if="${groupedProducts != null}" th:each="entry, iterStat : ${groupedProducts}">
                        <tr class="js-category-toggle"
                            th:attr="data-target='cat-' + ${iterStat.index}"
                            onclick="toggleCategory(this.getAttribute('data-target'))"
                            style="cursor: pointer; background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
                            <td colspan="5" style="padding: 12px 15px; border-left: 4px solid var(--accent);">
                                <div style="display: flex; justify-content: space-between; align-items: center; pointer-events: none;">
                            <span style="font-weight: 800; color: #1e293b; text-transform: uppercase; font-size: 12px;">
                                üìÇ <span th:text="${entry.key}">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</span>
                            </span>
                                    <span class="toggle-icon" style="transition: transform 0.3s;">‚ñº</span>
                                </div>
                            </td>
                        </tr>

                        <tr th:each="p : ${entry.value}"
                            th:classappend="'cat-' + ${iterStat.index}"
                            class="product-row-hover"
                            th:onclick="'openProductDetails(' + ${p.id} + ')'"
                            style="cursor:pointer; display: table-row;">

                            <td style="padding-left: 35px;">
                                <div style="font-weight: 600; color: #334155;" th:text="${p.name}">–ù–∞–∑–≤–∞–Ω–∏–µ</div>
                            </td>

                            <td style="font-weight: 700; color: #0f172a;"
                                th:text="${p.price != null ? #numbers.formatInteger(p.price, 1, 'WHITESPACE') + ' ÷è' : '0 ÷è'}">
                            </td>

                            <td>
                        <span th:with="qty=${p.stockQuantity ?: 0}"
                              th:class="|badge ${qty > 10 ? 'bg-light text-dark' : 'bg-danger text-white'}|"
                              style="padding: 6px 10px; border-radius: 6px;"
                              th:text="${qty + ' —à—Ç.'}">
                        </span>
                            </td>

                            <td th:text="${p.itemsPerBox ?: 1} + ' —à—Ç/—É–ø'"></td>

                            <td class="text-muted" style="font-family: monospace; font-size: 12px;"
                                th:text="${p.barcode ?: '---'}">
                            </td>

                            <td th:class="${p.expiryDate != null and p.expiryDate.isBefore(#temporals.createToday().plusDays(30))} ? 'text-danger fw-bold' : ''"
                                th:text="${p.expiryDate != null ? #temporals.format(p.expiryDate, 'dd.MM.yyyy') : '---'}"></td>
                        </tr>
                    </th:block>
                    </tbody>
                </table>
            </div>
        </div>


        <div id="tab-managers" class="tab-pane">
            <div class="filter-bar">
                <h4 style="margin: 0; font-weight: 800;">üèÜ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–π</h4>
                <form method="get" th:action="@{/admin}" class="d-inline-flex gap-2">
                    <input type="hidden" name="activeTab" value="tab-managers">
                    <input type="date" name="kpiStart" class="form-control" th:value="${orderStartDate}">
                    <input type="date" name="kpiEnd" class="form-control" th:value="${orderEndDate}">
                    <button type="submit" class="btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø–µ—Ä–∏–æ–¥</button>
                </form>
            </div>

            <div class="manager-table-container">
                <div class="managers-grid"
                     style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; margin-top: 20px;">

                    <th:block th:if="${managersKPI != null}" th:each="m : ${managersKPI}">
                        <div class="glass-card" th:with="stats=${managerStats != null ? managerStats.get(m) : null}"
                             style="padding: 20px; border-radius: 16px; border-left: 5px solid var(--accent);">

                            <div style="margin-bottom: 15px;">
                                <h5 style="margin: 0; font-weight: 800; color: #1e293b;" th:text="${m}">–ò–º—è</h5>
                                <span class="badge" style="background: #e0f2fe; color: #0369a1; font-size: 10px;">ID: [[${m}]]</span>
                            </div>

                            <div style="background: #eef2ff; padding: 12px; border-radius: 12px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <b style="font-size: 15px; color: #4f46e5;"
                                       th:text="${(stats != null and stats.targetAmount != null) ? #numbers.formatInteger(stats.targetAmount, 1, 'WHITESPACE') + ' ÷è' : '0 ÷è'}">
                                        0 ÷è
                                    </b>
                                    <button class="btn-ghost" th:data-manager-id="${m}"
                                            onclick="openSetTargetModal(this.getAttribute('data-manager-id'))">‚úèÔ∏è
                                    </button>
                                </div>
                            </div>

                            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                                <div style="flex: 1; background: #f0fdf4; padding: 12px; border-radius: 12px;">
                                    <small style="display:block; color: #166534; font-size: 10px; font-weight: 700; text-transform: uppercase;">–ü—Ä–æ–¥–∞–Ω–æ</small>
                                    <b style="font-size: 15px; color: #166534;">
                                <span th:if="${stats != null and stats.totalSales != null}"
                                      th:text="${#numbers.formatInteger(stats.totalSales, 1, 'WHITESPACE')} + ' ÷è'"></span>
                                        <span th:unless="${stats != null and stats.totalSales != null}">0 ÷è</span>
                                    </b>
                                </div>
                                <div style="flex: 1; background: #fff1f2; padding: 12px; border-radius: 12px;">
                                    <small style="display:block; color: #991b1b; font-size: 10px; font-weight: 700; text-transform: uppercase;">–í–æ–∑–≤—Ä–∞—Ç—ã</small>
                                    <b style="font-size: 15px; color: #991b1b;">
                                <span th:if="${stats != null and stats.totalReturns != null}"
                                      th:text="${#numbers.formatInteger(stats.totalReturns, 1, 'WHITESPACE')} + ' ÷è'"></span>
                                        <span th:unless="${stats != null and stats.totalReturns != null}">0 ÷è</span>
                                    </b>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; font-size: 11px; font-weight: 700; margin-bottom: 6px;">
                                    <span style="color: #64748b;">–ö–ü–î –ú–µ–Ω–µ–¥–∂–µ—Ä–∞</span>
                                    <span style="color: var(--accent);"
                                          th:text="${(stats != null ? stats.efficiency : 0)} + '%'">0%</span>
                                </div>
                                <div style="height: 8px; background: #f1f5f9; border-radius: 4px; overflow: hidden;">
                                    <div th:style="'height: 100%; transition: width 1s ease-in-out; background: var(--accent); width: ' + ${(stats != null ? stats.efficiency : 0)} + '%'"></div>
                                </div>
                            </div>

                            <div style="display: flex; gap: 8px;">
                                <button class="btn-ghost" style="flex: 1; padding: 8px;"
                                        th:data-name="${m}"
                                        onclick="showManagerInvoices(this.getAttribute('data-name'))">üí≥ –°—á–µ—Ç–∞
                                </button>
                                <button class="btn-ghost" style="flex: 1; padding: 8px;"
                                        th:data-name="${m}"
                                        onclick="showManagerReport(this.getAttribute('data-name'))">üìë –û—Ç—á–µ—Ç
                                </button>
                            </div>

                        </div>
                    </th:block>
                </div>
            </div>
        </div>


        <div id="tab-delivery" class="tab-pane">
            <div class="summary-card" style="background: #eff6ff; border-color: #bee3f8;">
                <div class="summary-item">
                    <small>–ó–∞–∫–∞–∑–æ–≤ –∫ –æ—Ç–≥—Ä—É–∑–∫–µ:</small>
                    <span th:text="${invoices != null ? invoices.size() : 0}">0</span>
                </div>
                <div class="summary-item">
                    <small>–î–∞—Ç–∞:</small>
                    <span th:text="${#temporals.format(#temporals.createNow(), 'dd.MM.yyyy')}"></span>
                </div>
            </div>

            <div class="logistics-bar"
                 style="margin-top: 25px; background: #fff; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0;">
                <h5 style="font-weight: 800; margin-bottom: 15px; color: #1e293b;">üöõ –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–Ω–æ–≥–æ –ª–∏—Å—Ç–∞</h5>

                <div class="d-flex flex-wrap gap-3 align-items-end">
                    <div style="flex: 1; min-width: 200px;">
                        <label style="font-size: 11px; font-weight: 700; color: #64748b; text-transform: uppercase;">–í–æ–¥–∏—Ç–µ–ª—å
                            / –ú–µ–Ω–µ–¥–∂–µ—Ä</label>
                        <select id="route-manager-select" class="form-select" style="margin-top: 5px;">
                            <option th:each="m : ${managers}" th:value="${m}" th:text="${m}"
                                    th:selected="${m == selectedOrderManager}"></option>
                        </select>
                    </div>

                    <div style="flex: 1; min-width: 150px;">
                        <label style="font-size: 11px; font-weight: 700; color: #64748b; text-transform: uppercase;">–î–∞—Ç–∞
                            –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                        <input type="date" id="route-date-select" class="form-control" style="margin-top: 5px;"
                               th:value="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}">
                    </div>

                    <div class="d-flex gap-2">
                        <button class="btn-primary" style="height: 40px; background: #0369a1;"
                                onclick="printRouteSheet()" title="–°–ø–∏—Å–æ–∫ –∞–¥—Ä–µ—Å–æ–≤ –∏ —Å—É–º–º">
                            üìÑ –ú–∞—Ä—à—Ä—É—Ç–Ω—ã–π –ª–∏—Å—Ç
                        </button>
                    </div>
                </div>

                <hr style="margin: 25px 0; border-color: #e2e8f0;">
                <h5 style="font-weight: 800; margin-bottom: 15px; color: #1e293b;">üì¶ –ú–∞—Å—Å–æ–≤–∞—è –ø–µ—á–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
                    (–ö–æ–º–ø–∞–∫—Ç–Ω–æ)</h5>
                <div class="d-flex gap-2">
                    <button class="btn-primary" style="background: #10b981; flex: 1;" onclick="printCompactOrders()">
                        üìë –ü–µ—á–∞—Ç—å –≤—Å–µ—Ö –ù–∞–∫–ª–∞–¥–Ω—ã—Ö
                    </button>

                    <button class="btn-primary" style="background: #ef4444; flex: 1;" onclick="printCompactReturns()">
                        üîÑ –ü–µ—á–∞—Ç—å –≤—Å–µ—Ö –í–æ–∑–≤—Ä–∞—Ç–æ–≤
                    </button>
                </div>
                <p style="font-size: 11px; color: #94a3b8; margin-top: 10px;">
                    *–§—É–Ω–∫—Ü–∏—è –ø–µ—á–∞—Ç–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –æ–¥–Ω–æ–º –ª–∏—Å—Ç–µ, —Ä–∞–∑–¥–µ–ª—è—è –∏—Ö –ø–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º.
                </p>
            </div>
        </div>


        <div id="tab-imports" class="tab-pane">
            <div class="glass-card" style="max-width: 600px; margin: 20px auto; text-align: center; padding: 40px;">
                <i class="bi bi-file-earmark-excel" style="font-size: 50px; color: #10b981;"></i>
                <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Excel</h3>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª .xlsx –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ —Ü–µ–Ω –Ω–∞ —Å–∫–ª–∞–¥–µ.</p>
                <button class="btn-primary" style="width: 100%;" onclick="triggerImport()">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª –∏
                    –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <hr>
                <small>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ –∏–º–ø–æ—Ä—Ç–∞ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –≤–æ –≤–∫–ª–∞–¥–∫–µ "–û–±–∑–æ—Ä"</small>
            </div>
        </div>

        <div id="tab-reports" class="tab-pane">
            <h6 style="margin-bottom: 10px; font-weight: 800; color: #1e293b;">üìä –¶–µ–Ω—Ç—Ä –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ –∏ —ç–∫—Å–ø–æ—Ä—Ç–∞</h6>
            <div style="display: flex; gap: 20px; margin-bottom: 10px;">
                <div style="flex: 1; background: #f0fdf4; border: 1px solid #bbf7d0; padding: 15px;
                    border-radius: 12px; display: flex; align-items: center; gap: 15px;">
                    <div>‚úÖ</div>
                    <div>
                        <small style="color: #166534; font-weight: 700; text-transform: uppercase; font-size: 10px;">–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ
                            –∑–∞–∫–∞–∑–æ–≤</small>

                    </div>
                    <div id="count-verified-orders" style="font-size: 15px; font-weight: 800; color: #1e293b;">0
                        –ø–æ–∑.
                    </div>
                </div>

                <div style="flex: 1; background: #fff1f2; border: 1px solid #fecdd3; padding: 15px; border-radius: 12px; display: flex; align-items: center; gap: 15px;">
                    <div>üìã</div>
                    <div>
                        <small style="color: #991b1b; font-weight: 700; text-transform: uppercase; font-size: 10px;">–ü—Ä–æ–≤–µ–¥–µ–Ω–æ
                            –≤–æ–∑–≤—Ä–∞—Ç–æ–≤</small>

                    </div>
                    <div id="count-processed-returns"
                         style="font-size: 15px; font-weight: 800; color: #1e293b;">0 –ø–æ–∑.
                    </div>
                </div>
            </div>


            <div class="filter-bar"
                 style="background: #f8fafc; padding: 20px; border-radius: 16px; display: flex; flex-wrap:
                     wrap; gap: 20px; align-items: flex-end; border: 1px solid #e2e8f0;">

                <div style="flex: 1; min-width: 300px;">
                    <label style="font-size: 11px; font-weight: 800; color: #64748b; text-transform: uppercase;">–ü–µ—Ä–∏–æ–¥
                        –≤—ã–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</label>
                    <div style="display: flex; gap: 12px; margin-top: 8px; align-items: center;">
                        <div style="flex: 1;">
                            <small style="color: #94a3b8;">–ù–∞—á–∞–ª–æ:</small>
                            <input type="date" id="report-start" class="form-control" th:value="${orderStartDate}">
                        </div>
                        <div style="flex: 1;">
                            <small style="color: #94a3b8;">–ö–æ–Ω–µ—Ü:</small>
                            <input type="date" id="report-end" class="form-control" th:value="${orderEndDate}">
                        </div>
                    </div>
                </div>

                <button type="button" class="btn-primary" style="height: 38px; margin-top: 18px;"
                        onclick="applyReportFilters()" title="–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ">‚ü≥
                </button>

                <div style="flex: 1; min-width: 250px;">
                    <label style="font-size: 11px; font-weight: 800; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px;">Email
                        –ø–æ–ª—É—á–∞—Ç–µ–ª—è</label>
                    <input type="email" id="report-email" class="form-control"
                           style="margin-top: 8px; height: 38px;"
                           placeholder="accountant@company.am" th:value="${@companySettings.getAccountantEmail()}">
                </div>

                <div>
                    <label style="font-size: 11px; font-weight: 800; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px;">–¢–∏–ø
                        –¥–∞–Ω–Ω—ã—Ö</label>
                    <div style="display: flex; gap: 15px; margin-top: 8px; align-items: center; height: 38px;">
                        <label><input type="checkbox" id="check-orders" checked> –ó–∞–∫–∞–∑—ã</label>
                        <label><input type="checkbox" id="check-returns"> –í–æ–∑–≤—Ä–∞—Ç—ã</label>
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button class="btn-primary"
                            style="background: #10b981; height: 45px; padding: 0 20px; font-weight: 700; border-radius: 10px;"
                            onclick="downloadExcel('orders')">
                        üì• –ó–∞–∫–∞–∑—ã (<span id="btn-count-orders">0</span>)
                    </button>
                    <button class="btn-primary"
                            style="background: #ef4444; height: 45px; padding: 0 20px; font-weight: 700; border-radius: 10px;"
                            onclick="downloadExcel('returns')">
                        üì• –í–æ–∑–≤—Ä–∞—Ç—ã (<span id="btn-count-returns">0</span>)
                    </button>
                    <button class="btn-primary"
                            style="background: #6366f1; height: 45px; padding: 0 20px; font-weight: 700; border-radius: 10px;"
                            onclick="sendToEmail()">
                        ‚úâÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                    </button>

                    <div style="font-size: 12px; color: #64748b; max-width: 400px; margin: 0;">
                        <b>üí° –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</b> –í –æ—Ç—á–µ—Ç—ã –ø–æ–ø–∞–¥–∞—é—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã –∏ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—Ç—ã –∑–∞
                        —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.
                    </div>

                </div>
            </div>


            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                <h6 style="font-weight: 800; color: #1e293b; margin: 0;">
                    üìù –†–µ–µ—Å—Ç—Ä –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫ (–¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–∫—Ç—É—Ä)
                </h6>
                <div style="text-align: right;">
                    <small class="text-muted" style="display: block;">–í—ã–±—Ä–∞–Ω–æ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:</small>

                </div>
                <b id="selected-count" style="color: #6366f1; font-size: 18px;">0</b>

                <button class="btn-primary"
                        style="background: #6366f1; padding: 12px 30px; font-weight: 700; border-radius: 10px; border: none; box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.4);"
                        onclick="sendSelectedCorrections()">
                    ‚úâÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –≤ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—é
                </button>

            </div>

            <div class="table-container"
                 style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 12px;">

                <table class="table">
                    <thead style="position: sticky; top: 0; background: #f8fafc; z-index: 5;">
                    <tr>
                        <th style="width: 50px; text-align: center;">
                            <input type="checkbox" id="select-all-corrections"
                                   onclick="toggleAllCorrections(this)"
                                   style="transform: scale(1.2); cursor: pointer;">
                        </th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ú–∞–≥–∞–∑–∏–Ω</th>
                        <th>–¢–∏–ø –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏</th>
                        <th>–°—É–º–º–∞ (÷è)</th>
                        <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                    </tr>
                    </thead>

                    <tbody id="corrections-list-body">
                    <th:block th:if="${returns != null}" th:each="r : ${returns}">
                        <tr th:if="${r.returnReason != null and (r.returnReason.name() eq 'CORRECTION_ORDER' or r.returnReason.name() eq 'CORRECTION_RETURN')}">
                            <td style="text-align: center;">
                                <input type="checkbox" class="correction-checkbox"
                                       th:value="${r.id}"
                                       onchange="updateSelectedCount()"
                                       style="transform: scale(1.2); cursor: pointer;">
                            </td>
                            <td class="js-date-format" th:text="${r.createdAt}"></td>
                            <td th:text="${r.shopName}" style="font-weight: 700;"></td>
                            <td>
                                <span class="badge"
                                      style="background: #dcfce7; color: #166534; border: 1px solid #bbf7d0;"
                                      th:text="${r.returnReason.displayName}"></span>
                            </td>
                            <td class="price-down"
                                th:text="${r.totalAmount != null ? #numbers.formatInteger(r.totalAmount, 1, 'WHITESPACE') + ' ÷è' : '0 ÷è'}">
                            </td>
                            <td th:text="${r.comment ?: '---'}" style="font-size: 11px; color: #64748b;"></td>
                        </tr>
                    </th:block>

                    <tr th:if="${returns == null or #lists.isEmpty(returns)}">
                        <td colspan="6" style="text-align: center; padding: 40px; color: #94a3b8;">
                            –ù–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç –Ω–æ–≤—ã—Ö –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>


        </div>

        <div id="tab-settings" class="tab-pane">
            <div class="glass-card" style="max-width: 800px; margin: 20px auto; padding: 30px;">
                <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h3>
                <hr>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
                        <input type="text" id="set-COMPANY_NAME" class="form-control"
                               th:value="${@companySettings.getSetting('COMPANY_NAME', '’ç’•’¨’¨’´’∏’∂ ’ç’ä‘∏')}">
                    </div>
                    <div class="col-md-6">
                        <label>Email –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∞</label>
                        <input type="email" id="set-ACCOUNTANT_EMAIL" class="form-control"
                               th:value="${@companySettings.getAccountantEmail()}">
                    </div>
                    <div class="col-md-6">
                        <label>–ò–ù–ù (’Ä’é’Ä’Ä)</label>
                        <input type="text" id="set-COMPANY_INN" class="form-control"
                               th:value="${@companySettings.getSetting('COMPANY_INN', '01234567')}">
                    </div>
                    <div class="col-md-6">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞</label>
                        <input type="text" id="set-COMPANY_BANK_NAME" class="form-control"
                               th:value="${@companySettings.getSetting('COMPANY_BANK_NAME', '---')}">
                    </div>
                    <div class="col-md-6">
                        <label>–ù–æ–º–µ—Ä —Å—á–µ—Ç–∞ (IBAN)</label>
                        <input type="text" id="set-COMPANY_BANK_ACCOUNT" class="form-control"
                               th:value="${@companySettings.getSetting('COMPANY_BANK_ACCOUNT', '---')}">
                    </div>

                    <div class="col-12">
                        <label>–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å</label>
                        <input type="text" id="set-COMPANY_ADDRESS" class="form-control"
                               th:value="${@companySettings.getSetting('COMPANY_ADDRESS', '’Ä’Ä, ÷Ñ. ‘µ÷Ä÷á’°’∂')}">
                    </div>
                </div>
                <button class="btn-primary mt-4" style="width: 100%;" onclick="saveAllSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </button>
            </div>
        </div>


        <div id="tab-main" class="tab-pane">
            <div class="modern-grid-top"
                 style="grid-template-columns: 1fr 1fr 1.2fr 0.8fr; gap: 15px; margin-bottom: 20px;">

                <div class="glass-card">
                    <div style="font-size: 11px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px;">
                        <span class="dot dot-accent"></span>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫
                    </div>
                    <div style="font-size: 22px; font-weight: 800; letter-spacing: -0.5px;" id="stat-avg-check"
                         th:text="${(totalOrdersCount != null and totalOrdersCount > 0) ? #numbers.formatInteger(totalOrdersSum / totalOrdersCount, 1, 'WHITESPACE') + ' ÷è' : '0 ÷è'}">
                        0 ÷è
                    </div>
                    <div style="font-size: 11px; color: #64748b; margin-top: 2px;">
                        –û–∂–∏–¥–∞–µ—Ç: <span id="stat-pending-orders" style="font-weight: 700;"
                                       th:text="${pendingOrdersCount ?: 0}">0</span>
                    </div>
                </div>

                <div class="glass-card"
                     style="background: linear-gradient(to bottom right, #ffffff, #f0fdf4) !important;">
                    <div style="font-size: 11px; font-weight: 700; color: #15803d; text-transform: uppercase; margin-bottom: 4px;">
                        <span class="dot" style="background: #22c55e;"></span>–ü—Ä–∏–±—ã–ª—å
                    </div>
                    <div style="font-size: 22px; font-weight: 800; color: #15803d; letter-spacing: -0.5px;"
                         th:text="${netProfit != null ? #numbers.formatInteger(netProfit, 1, 'WHITESPACE') + ' ÷è' : '0 ÷è'}">
                        0 ÷è
                    </div>
                </div>


                <div class="glass-card" style="align-items: center; text-align: center;">
                    <div style="font-size: 10px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; margin-bottom: 5px;">
                        –°—Ç–∞—Ç—É—Å
                    </div>
                    <div style="display: flex; align-items: center; background: #f0fdf4; padding: 6px 12px; border-radius: 12px;">
                        <span class="dot dot-online"></span>
                        <span style="font-size: 12px; font-weight: 700; color: #166534;">Online</span>
                    </div>
                    <div style="font-size: 10px; color: #94a3b8; margin-top: 4px;" sec:authentication="name">ADMIN</div>
                </div>
            </div>

            <div class="table-container" style="flex-grow: 1;">
                <div style="padding: 12px 20px; border-bottom: 1px solid var(--border); background: #fff; position: sticky; top: 0; z-index: 10;">
                    <h5 style="margin: 0; font-weight: 700; font-size: 14px; display: flex; align-items: center; gap: 10px;">
                        –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ <span class="badge" style="font-weight: 400;">Audit Log 2026</span>
                    </h5>
                </div>
                <table class="table">
                    <thead>
                    <tr>
                        <th style="width: 150px;">–î–∞—Ç–∞</th>
                        <th style="width: 200px;">–î–µ–π—Å—Ç–≤–∏–µ</th>
                        <th>–î–µ—Ç–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏</th>
                    </tr>
                    </thead>
                    <tbody id="import-log-body">
                    <th:block th:if="${auditLogs != null and !#lists.isEmpty(auditLogs)}">
                        <tr th:each="log : ${auditLogs}">
                            <td style="color: var(--text-muted)"
                                th:text="${log.timestamp != null ? #temporals.format(log.timestamp, 'dd.MM HH:mm') : '--.--'}"></td>
                            <td>
                <span class="badge" style="background: #eef2ff; color: #4338ca; border: none;"
                      th:text="${log.action}"></span>
                            </td>
                            <td th:text="${log.details}"></td>
                        </tr>
                    </th:block>

                    <tr th:if="${auditLogs == null or #lists.isEmpty(auditLogs)}">
                        <td colspan="3" style="text-align: center; color: #94a3b8; padding: 20px;">–û–ø–µ—Ä–∞—Ü–∏–π –ø–æ–∫–∞ –Ω–µ
                            –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="modal-order-view" class="modal">
            <div class="modal-content">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                    <h2 id="modal-title" style="margin: 0;">–î–µ—Ç–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏</h2>
                    <button onclick="closeModal('modal-order-view')"
                            style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;
                    </button>
                </div>
                <div id="order-info">
                </div>
                <div id="table-scroll-container">
                    <table class="table">
                        <thead>
                        <tr>
                            <th>–¢–æ–≤–∞—Ä</th>
                            <th>–ö–æ–ª-–≤–æ</th>
                            <th>–¶–µ–Ω–∞</th>
                            <th>–ò—Ç–æ–≥–æ</th>
                            <th>–ö–∞—Ç.</th>
                        </tr>
                        </thead>
                        <tbody id="order-items-body"></tbody>
                    </table>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto; padding-top: 20px; border-top: 2px solid #eee; flex-shrink: 0;">
                    <div id="order-total-price" style="font-size: 20px; font-weight: 800; color: var(--accent);"></div>
                    <div id="order-footer-actions" style="display: flex; gap: 10px;"></div>
                </div>
            </div>
        </div>


        <div id="modal-order-create" class="modal">
            <div class="modal-content" style="width: 650px; max-height: 90vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">üõí –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞</h2>
                    <button onclick="closeModal('modal-order-create')"
                            style="background:none; border:none; font-size:24px; cursor:pointer;">&times;
                    </button>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <label style="font-size: 11px; font-weight: 800; color: #64748b;">–ú–ê–ì–ê–ó–ò–ù</label>
                        <select id="new-order-client-id" class="form-select">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω...</option>
                            <option th:each="c : ${clients}" th:value="${c.id}" th:text="${c.name}"></option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label style="font-size: 11px; font-weight: 800; color: #64748b;">–ú–ï–ù–ï–î–ñ–ï–†</label>
                        <select id="new-order-manager-id" class="form-select">
                            <option th:each="m : ${managers}" th:value="${m}" th:text="${m}"></option>
                        </select>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <label style="font-size: 11px; font-weight: 800; color: #64748b;">–¢–ò–ü –ù–ê–ö–õ–ê–î–ù–û–ô</label>
                        <select id="new-order-separate-invoice" class="form-select" style="border: 2px solid #6366f1;">
                            <option value="false">–û–±—â–∞—è –Ω–∞–∫–ª–∞–¥–Ω–∞—è (—Å–≤–æ–¥–Ω–∞—è)</option>
                            <option value="true">–†–∞–∑–¥–µ–ª—å–Ω–∞—è —Ñ–∞–∫—Ç—É—Ä–∞ (–æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–∏—Å—Ç)</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label style="font-size: 11px; font-weight: 800; color: #64748b;">–ú–ï–¢–û–î –û–ü–õ–ê–¢–´</label>
                        <select id="new-order-payment-method" class="form-select">
                            <option th:each="pm : ${paymentMethods}" th:value="${pm}"
                                    th:text="${pm.displayName}"></option>
                        </select>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <label style="font-size: 11px; font-weight: 800; color: #64748b;">–î–ê–¢–ê –î–û–°–¢–ê–í–ö–ò</label>
                        <input type="date" id="new-order-delivery-date" class="form-control">
                    </div>
                    <div class="col-md-6">
                        <label style="font-size: 11px; font-weight: 800; color: #64748b;">–ù–û–ú–ï–† –ê–í–¢–û</label>
                        <input type="text" id="new-order-car" class="form-control" placeholder="–ù–∞–ø—Ä: 35XX000">
                    </div>
                </div>


                <div style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <h4 style="font-size: 14px; margin: 0;">–¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ</h4>
                        <button type="button" class="btn-primary" style="padding: 4px 12px; font-size: 11px;"
                                onclick="addItemRowToOrder()">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
                        </button>
                    </div>
                    <div id="new-order-items-list" style="margin-top: 10px; max-height: 150px; overflow-y: auto;"></div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 25px; justify-content: flex-end;">
                    <button class="btn-primary" onclick="submitCreateOrder()"
                            style="background-color: #10b981; padding: 10px 25px;">–°–û–ó–î–ê–¢–¨ –ó–ê–ö–ê–ó
                    </button>
                    <button class="btn-primary" style="background-color: #64748b;"
                            onclick="closeModal('modal-order-create')">–û–¢–ú–ï–ù–ê
                    </button>
                </div>
            </div>
        </div>


        <div id="modal-client-view" class="modal">
            <div class="modal-content">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                    <h2 id="modal-client-title" style="margin: 0;">–î–µ—Ç–∞–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞</h2>
                    <button onclick="closeModal('modal-client-view')"
                            style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;
                    </button>
                </div>
                <div id="client-info">

                </div>


                <div id="table-scroll-container-client" style="flex-grow: 1; overflow-y: auto; margin: 10px 0;">
                </div>

                <div id="client-footer-actions"
                     style="display: flex; justify-content: flex-end; align-items: center; margin-top: auto; padding-top: 10px; border-top: 2px solid #eee; flex-shrink: 0; gap: 10px;">
                    <button class="btn-primary" onclick="enableClientEdit()">–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                    <button class="btn-primary" style="background:#64748b" onclick="closeModal('modal-client-view')">
                        –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>
            </div>
        </div>


        <div id="modal-client" class="modal">
            <div class="modal-content" style="width: 500px;">
                <h2 style="margin-bottom:20px;">üë§ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞</h2>
                <!-- –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ Java-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä /admin/clients/create -->
                <form th:action="@{/admin/clients/create}" method="post">
                    <div class="modal-info-row">

                        <div>
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞</label><input type="text" name="name" required
                                                                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ó–û–í–ö –ü–∞–ø–∞–∑—è–Ω">
                            <label>–í–ª–∞–¥–µ–ª–µ—Ü / –ò–ü</label><input type="text" name="ownerName" placeholder="–§–ò–û –í–ª–∞–¥–µ–ª—å—Ü–∞">
                            <label>–ò–ù–ù</label><input type="text" name="inn" placeholder="–ò–ù–ù">

                            <label>–ú–µ–Ω–µ–¥–∂–µ—Ä</label>
                            <select name="managerId" id="new-client-manager-id">
                            </select>
                        </div>
                    </div>
                    <div class="modal-info-row" style="margin-top:10px;">
                        <div>
                            <label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input type="text" name="phone" placeholder="+374 XX XX XX">
                            <label>–ê–¥—Ä–µ—Å</label><input type="text" name="address" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏">
                            <label>–î–µ–Ω—å –º–∞—Ä—à—Ä—É—Ç–∞</label><input type="text" name="routeDay"
                                                               placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –í—Ç–æ—Ä–Ω–∏–∫">

                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 25px; justify-content: flex-end;">
                        <button type="submit" class="btn-primary" style="background:#10b981">–°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
                        <button type="button" class="btn-primary" style="background:#64748b"
                                onclick="closeModal('modal-client')">–û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </form>
            </div>
        </div>


        <div id="modal-product-view" class="modal">
            <div class="modal-content">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                    <h2 id="modal-product-title" style="margin: 0;">–î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞</h2>
                    <button onclick="closeModal('modal-product-view')"
                            style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;
                    </button>
                </div>

                <div id="product-info">


                </div>

                <div id="product-footer-actions"
                     style="display: flex; justify-content: flex-end; align-items: center; margin-top: auto; padding-top: 10px; border-top: 2px solid #eee; flex-shrink: 0; gap: 10px;">
                    <button class="btn-primary" onclick="enableProductEdit()">–ò–∑–º–µ–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
                    <button class="btn-primary" style="background:#64748b" onclick="closeModal('modal-product-view')">
                        –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>
            </div>
        </div>


        <div id="modal-payment" class="modal">
            <div class="modal-content" style="width: 450px; border-top: 5px solid #10b981;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0; color: #1e293b;">üí≥ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–ø–ª–∞—Ç—ã</h3>
                    <button onclick="closeModal('modal-payment')"
                            style="background:none; border:none; font-size:24px; cursor:pointer;">&times;
                    </button>
                </div>

                <input type="hidden" id="pay-invoice-id">

                <div style="background: #f0fdf4; padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                    <small style="color: #166534; font-weight: 700; text-transform: uppercase;">–ù–æ–º–µ—Ä —Å—á–µ—Ç–∞:</small>
                    <div id="pay-invoice-display" style="font-size: 18px; font-weight: 800; color: #1e293b;">---</div>
                </div>

                <div class="mb-3">
                    <label style="font-size: 11px; font-weight: 800; color: #64748b;">–°–£–ú–ú–ê –û–ü–õ–ê–¢–´ (÷è)</label>
                    <input type="number" id="pay-amount" class="form-control form-control-lg"
                           placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É..." style="font-weight: 800; color: #10b981;">
                </div>

                <div class="mb-4">
                    <label style="font-size: 11px; font-weight: 800; color: #64748b;">–°–ü–û–°–û–ë –û–ü–õ–ê–¢–´</label>
                    <select id="pay-comment" class="form-select">
                        <option value="–ù–∞–ª–∏—á–Ω—ã–µ">üíµ –ù–∞–ª–∏—á–Ω—ã–µ</option>
                        <option value="–ü–µ—Ä–µ–≤–æ–¥">üè¶ –ë–µ–∑–Ω–∞–ª–∏—á–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥</option>
                    </select>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button class="btn-primary" onclick="submitPayment()"
                            style="flex: 2; background: #10b981; height: 45px; font-weight: 700;">–ü–û–î–¢–í–ï–†–î–ò–¢–¨
                    </button>
                    <button class="btn-primary" onclick="closeModal('modal-payment')"
                            style="flex: 1; background: #64748b; height: 45px;">–û–¢–ú–ï–ù–ê
                    </button>
                </div>
            </div>
        </div>


        <div id="modal-product-create-new" class="modal">
            <div class="modal-content" style="width: 500px;">
                <h2 style="margin-bottom:20px;">üì¶ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞</h2>
                <div class="modal-info-row">
                    <div style="flex:1">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" id="new-p-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
                        <label>–¶–µ–Ω–∞ (÷è)</label><input type="number" id="new-p-price" placeholder="0">
                        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label><input type="text" id="new-p-cat" placeholder="–ù–∞–ø–∏—Ç–∫–∏, –ï–¥–∞...">
                        <label>–ï–¥. –∏–∑–º–µ—Ä–µ–Ω–∏—è</label>
                        <select id="new-p-unit">
                            <option value="—à—Ç">—à—Ç</option>
                            <option value="–∫–≥">–∫–≥</option>
                            <option value="–∫–æ—Ä">–∫–æ—Ä</option>
                        </select>
                    </div>
                </div>
                <div class="modal-info-row" style="margin-top:10px;">
                    <div style="flex:1">
                        <label>–û—Å—Ç–∞—Ç–æ–∫</label><input type="number" id="new-p-qty" value="0">
                        <label>–®—Ç—Ä–∏—Ö-–∫–æ–¥</label><input type="text" id="new-p-code" placeholder="000000">
                        <label>–í –∫–æ—Ä–æ–±–∫–µ</label><input type="number" id="new-p-box" value="1">
                        <label>–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏</label>
                        <input type="date" id="new-p-expiry">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 25px; justify-content: flex-end;">
                    <button class="btn-primary" onclick="submitCreateProduct()" style="background:#10b981">–°–æ–∑–¥–∞—Ç—å
                        —Ç–æ–≤–∞—Ä
                    </button>
                    <button class="btn-primary" style="background:#64748b"
                            onclick="closeModal('modal-product-create-new')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>


        <div id="modal-set-target" class="modal">
            <div class="modal-content" style="width: 400px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ü–µ–ª—å –ø—Ä–æ–¥–∞–∂</h3>
                    <button onclick="closeModal('modal-set-target')"
                            style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;
                    </button>
                </div>

                <p>–ú–µ–Ω–µ–¥–∂–µ—Ä: <b id="target-manager-name"></b></p>
                <label>–°—É–º–º–∞ —Ü–µ–ª–∏ (÷è)</label>
                <input type="number" id="target-amount-input" class="form-control">

                <div style="margin-top:20px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="btn-primary" onclick="saveTargetSales()" style="background:#10b981;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                    <button class="btn-primary" style="background:#64748b;" onclick="closeModal('modal-set-target')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>


        <div id="tab-users" class="tab-pane">
            <div class="d-flex justify-content-between align-items-center mb-4" style="gap: 20px;">
                <div class="search-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-users"
                           onkeyup="filterTable('search-users', 'users-table-body')"
                           placeholder="–ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤..."
                           class="form-control w-25">
                </div>
                <button class="btn-primary" onclick="openCreateUserModal()">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                </button>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th style="width: 50px;"></th> <!-- –î–ª—è –∞–≤–∞—Ç–∞—Ä–∞ -->
                        <th>–õ–æ–≥–∏–Ω</th>
                        <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫ (–§–ò–û)</th>
                        <th>–£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞</th>
                        <th style="width: 150px; text-align: right;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th>
                    </tr>
                    </thead>
                    <tbody id="users-table-body">
                    <tr th:each="u : ${users}" th:onclick="|openUserDetailsModal('${u.id}')|" class="cursor-pointer">
                        <td>
                            <div class="user-avatar" th:text="${#strings.substring(u.fullName,0,1)}">A</div>
                        </td>
                        <td th:text="${u.username}" style="font-weight:600; color: var(--accent);"></td>
                        <td>
                            <div th:text="${u.fullName}" style="font-weight: 700; font-size: 13px;"></div>
                            <div style="font-size: 11px; color: var(--text-muted);">–ê–∫—Ç–∏–≤–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ</div>
                        </td>
                        <td>
                    <span th:class="'role-badge ' + (${u.role == 'ADMIN' ? 'role-admin' : 'role-user'})"
                          th:text="${u.role}">
                    </span>
                        </td>
                        <td onclick="event.stopPropagation()" style="text-align: right;">
                            <button class="btn-air btn-sm"
                                    th:onclick="'event.stopPropagation(); resetPassword(' + ${u.id} + ')'"
                                    title="–°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å">
                                <i class="fas fa-key"></i> –°–±—Ä–æ—Å
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="modal-user-create" class="modal">
            <div class="modal-content" style="width: 500px;">
                <h2 style="margin-bottom:20px;">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h2>
                <div class="modal-info-row">
                    <div style="flex:1">
                        <label>–õ–æ–≥–∏–Ω (Username)</label><input type="text" id="new-u-username"
                                                              placeholder="op1, acc1, boss">
                        <label>–ü–æ–ª–Ω–æ–µ –§–ò–û</label><input type="text" id="new-u-fullname"
                                                        placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
                    </div>
                </div>
                <div class="modal-info-row" style="margin-top:10px;">
                    <div style="flex:1">
                        <label>–†–æ–ª—å</label>
                        <select id="new-u-role">
                            <option value="OPERATOR">–û–ø–µ—Ä–∞—Ç–æ—Ä</option>
                            <option value="ACCOUNTANT">–ë—É—Ö–≥–∞–ª—Ç–µ—Ä</option>
                            <option value="ADMIN">–ê–¥–º–∏–Ω</option>
                        </select>
                        <label>–ü–∞—Ä–æ–ª—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é '1111')</label>
                        <input type="text" id="new-u-password" value="1111">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 25px; justify-content: flex-end;">
                    <button class="btn-primary" onclick="submitCreateUser()" style="background:#10b981">–°–æ–∑–¥–∞—Ç—å
                        —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                    </button>
                    <button class="btn-primary" style="background:#64748b" onclick="closeModal('modal-user-create')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>


        <div id="modal-inventory" class="modal">
            <div class="modal-content" style="width: 450px;">
                <h2 style="margin-bottom: 20px;">‚öñÔ∏è –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è —Å–∫–ª–∞–¥–∞</h2>
                <input type="hidden" id="inv-product-id">

                <div class="modal-info-row">
                    <div>
                        <label>–¢–æ–≤–∞—Ä</label>
                        <b id="inv-product-name" style="display: block; padding-top: 8px;">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</b>
                    </div>
                </div>

                <div class="modal-info-row" style="margin-top: 10px;">
                    <div>
                        <label>–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫ –Ω–∞ –ø–æ–ª–∫–µ (—à—Ç.)</label>
                        <input type="number" id="inv-actual-qty" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ">
                    </div>
                </div>

                <div class="modal-info-row" style="margin-top: 10px;">
                    <div>
                        <label>–ü—Ä–∏—á–∏–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏</label>
                        <input type="text" id="inv-reason" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ë–æ–π —Ç–æ–≤–∞—Ä–∞ / –ò–∑–ª–∏—à–∫–∏">
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 25px; justify-content: flex-end;">
                    <button class="btn-primary" onclick="submitInventoryAdjustment()" style="background:#10b981">
                        –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                    </button>
                    <button class="btn-primary" style="background:#64748b" onclick="closeModal('modal-inventory')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>


        <dialog id="confirm-modal" class="confirm-modal-image-style">
            <div class="confirm-modal-content">
                <h3 id="confirm-title" class="confirm-title-image-style">–£–¥–∞–ª–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç?</h3>
                <p id="confirm-text" class="confirm-text-image-style">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –≤–æ–∑–≤—Ä–∞—Ç?</p>

                <div class="confirm-actions-image-style">
                    <button class="btn-primary btn-danger" id="confirm-yes">–î–∞</button>
                    <button class="btn-primary btn-secondary" id="confirm-no">–ù–µ—Ç</button>
                </div>
            </div>
        </dialog>

        <div id="toast-container"></div>


        <script th:src="@{/js/sockjs.min.js}"></script>
        <script th:src="@{/js/stomp.min.js}"></script>


        <script th:inline="javascript">
            const ordersData = /*[[${orders}]]*/ [] ?? [];
            const returnsData = /*[[${returns}]]*/ [] ?? [];
            const productsData = /*[[${products}]]*/ [] ?? [];
            const clientsData = /*[[${clients}]]*/ [] ?? [];
            const usersData = /*[[${users}]]*/ [] ?? [];

            const paymentMethods = /*[[${paymentMethods}]]*/ [] ?? [];
            const returnReasons = /*[[${returnReasons}]]*/ [] ?? [];

            console.log("ERP System 2026 initialized. Data status: OK");
        </script>


        <script th:src="@{/js/script.js}"></script>

        <iframe id="printFrame" name="printFrame" style="display:none;"></iframe>
    </div>
</div>
<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>


</body>

</html>