<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Sellion ERP 2026</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<div class="sidebar">
    <div class="brand">SELLION 2026</div>
    <div onclick="showTab('tab-orders')" class="nav-link" id="btn-orders"><i class="bi bi-cart"></i> –ó–∞–∫–∞–∑—ã</div>
    <div onclick="showTab('tab-returns')" class="nav-link" id="btn-returns"><i class="bi bi-arrow-counterclockwise"></i>
        –í–æ–∑–≤—Ä–∞—Ç—ã
    </div>
    <div onclick="showTab('tab-clients')" class="nav-link" id="btn-clients"><i class="bi bi-people"></i> –ö–ª–∏–µ–Ω—Ç—ã</div>
    <div onclick="showTab('tab-products')" class="nav-link" id="btn-products"><i class="bi bi-box-seam"></i> –°–∫–ª–∞–¥ /
        –¶–µ–Ω—ã
    </div>

    <div onclick="showTab('tab-invoices')" class="nav-link" id="btn-invoices">
        <i class="bi bi-file-earmark-text"></i> –°—á–µ—Ç–∞ / –û–ø–ª–∞—Ç–∞
    </div>
    <div onclick="showTab('tab-users')" class="nav-link" id="btn-users"><i class="bi bi-person-badge"></i> –ü–µ—Ä—Å–æ–Ω–∞–ª
    </div>

    <div onclick="showTab('tab-main')" class="nav-link" id="btn-main">
        <i class="bi bi-speedometer2"></i> –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã
    </div>


    <form th:action="@{/logout}" method="post" style="margin-top:auto; padding:20px;">
        <button type="submit"
                style="width:100%; background:#ef4444; color:white; border:none; padding:10px; border-radius:8px; cursor:pointer; font-weight:700;">
            –í–´–•–û–î
        </button>
    </form>
</div>

<div class="main">
    <div class="scroll-area">

        <!-- –í–ö–õ–ê–î–ö–ê –ó–ê–ö–ê–ó–´ -->
        <div id="tab-orders" class="tab-pane">
            <div class="summary-card">
                <div class="summary-item"><small>–ó–∞–∫–∞–∑–æ–≤ –≤—Å–µ–≥–æ:</small> <span th:text="${totalOrdersCount}">0</span>
                </div>
                <div class="summary-item"><small>–û–±—â–∞—è —Å—É–º–º–∞:</small> <span class="price-up"
                                                                            th:text="${#numbers.formatInteger(totalOrdersSum, 1, 'WHITESPACE') + ' ÷è'}">0</span>
                </div>
            </div>

            <div class="filter-bar">
                <input type="text" id="search-orders" onkeyup="filterTable('search-orders', 'orders-table-body')"
                       placeholder="üîé –ü–æ–∏—Å–∫ –ø–æ –º–∞–≥–∞–∑–∏–Ω—É..." class="form-control w-25">

                <form method="get" th:action="@{/admin}" class="d-inline-flex gap-2">
                    <input type="hidden" name="activeTab" value="tab-orders">
                    <select name="orderManagerId" onchange="this.form.submit()" class="form-select">
                        <option value="">–í—Å–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã (–ó–∞–∫–∞–∑—ã)</option>
                        <option th:each="m : ${managers}" th:value="${m}" th:text="${m}"
                                th:selected="${m == selectedOrderManager}"></option>
                    </select>
                </form>
                <button class="btn-primary" onclick="openCreateOrderModal()">+ –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>

            </div>

            <div class="table-container">
                <table class="table">
                    <thead>

                    <tr>
                        <th>–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</th>
                        <th>–ú–µ–Ω–µ–¥–∂–µ—Ä</th>
                        <th>–ú–∞–≥–∞–∑–∏–Ω</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–î–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                    </tr>
                    </thead>
                    <tbody id="orders-table-body">
                    <tr th:each="o : ${orders}" th:onclick="'openOrderDetails(' + ${o.id} + ')'"
                        style="cursor:pointer;">
                        <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ createdAt -->
                        <td th:with="dt=${o.createdAt}"
                            th:text="${dt != null ? #strings.replace((dt.length() > 16 ? #strings.substring(dt, 0, 16) : dt), 'T', ' ') : ''}">
                        </td>


                        <td th:unless="${o.createdAt != null}"></td>

                        <td th:text="${o.managerId}" style="font-weight:600; color:var(--accent);"></td>
                        <td th:text="${o.shopName}" style="font-weight:700;"></td>
                        <td class="price-up"
                            th:text="${#numbers.formatInteger(o.totalAmount, 1, 'WHITESPACE') + ' ÷è'}"></td>
                        <td th:text="${o.deliveryDate}"></td>

                        <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: TRANSFER -> –ü–µ—Ä–µ–≤–æ–¥ -->

                        <td>
                            <span class="badge"
                                  th:text="${o.paymentMethod != null ? o.paymentMethod.displayName : o.status}">
                             </span>
                        </td>


                        <td onclick="event.stopPropagation()">
                            <form th:if="${o.invoiceId == null}"
                                  th:action="@{'/admin/invoices/create-from-order/' + ${o.id}}" method="post">
                                <button type="submit" class="btn-primary" style="padding:5px 10px; font-size:11px;">
                                    –°—á–µ—Ç
                                </button>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="tab-invoices" class="tab-pane">
            <div class="summary-card" style="background: #f0fdf4; border-color: #bbf7d0; display: flex; gap: 50px;">
                <div class="summary-item">
                    <small>–û–±—â–∏–π –¥–æ–ª–≥ –ø–æ —Å—á–µ—Ç–∞–º:</small><br>
                    <span class="price-down"
                          th:text="${#numbers.formatInteger(totalInvoiceDebt, 1, 'WHITESPACE') + ' ÷è'}"></span>
                </div>
                <div class="summary-item">
                    <small>–û–ø–ª–∞—á–µ–Ω–Ω—ã–π –¥–æ–ª–≥ –ø–æ —Å—á–µ—Ç–∞–º:</small><br>
                    <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é totalPaidSum –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞, –±–µ–∑ —Ç–µ–≥–∞ <td> -->

                    <!--                     ete bag exav es kareli e porcel-->
                    <!--                    <span class="price-up"-->
                    <!--                          th:text="${totalPaidSum != null ? #numbers.formatInteger(totalPaidSum, 1, 'WHITESPACE') + ' ÷è' : '0 ÷è'}">-->
                    <!--                    </span>-->

                    <span class="price-up"
                          th:text="${totalPaidSum == null ? '0 ÷è' : #numbers.formatInteger(totalPaidSum, 1, 'WHITESPACE') + ' ÷è'}">
                    </span>
                </div>
            </div>
            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th>‚Ññ –°—á–µ—Ç–∞</th>
                        <th>–ú–∞–≥–∞–∑–∏–Ω</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–û–ø–ª–∞—á–µ–Ω–æ</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                    </tr>
                    </thead>
                    <tbody id="invoices-table-body">
                    <tr th:each="inv : ${invoices}">
                        <td th:text="${inv.invoiceNumber}"></td>
                        <td th:text="${inv.shopName}" style="font-weight:700;"></td>
                        <td th:text="${#numbers.formatInteger(inv.totalAmount, 1, 'WHITESPACE') + ' ÷è'}"></td>
                        <td class="price-up"
                            th:text="${#numbers.formatInteger(inv.paidAmount, 1, 'WHITESPACE') + ' ÷è'}"></td>
                        <td>
                        <span th:class="'badge ' + (${inv.status} == 'PAID' ? 'bg-success text-white' : 'bg-warning')"
                              th:text="${inv.status}"></span>
                        </td>
                        <td>
                            <div style="display: flex; gap: 5px;">
                                <button class="btn-primary" style="padding:5px;"
                                        th:onclick="'openPaymentModal(' + ${inv.id} + ')'">üí≥ –û–ø–ª–∞—Ç–∞
                                </button>
                                <button class="btn-primary" style="background:#64748b; padding:5px;"
                                        th:onclick="'printInvoiceInline(' + ${inv.id} + ')'">
                                    üñ® –ü–µ—á–∞—Ç—å
                                </button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>


        <!-- –í–ö–õ–ê–î–ö–ê –í–û–ó–í–†–ê–¢–´ -->
        <div id="tab-returns" class="tab-pane">

            <div class="summary-card" style="background: #fff1f2; border-color: #fecdd3;">
                <div class="summary-item"><small>–í–æ–∑–≤—Ä–∞—Ç–æ–≤ –≤—Å–µ–≥–æ:</small>
                    <span th:text="${totalReturnsCount}">0</span>
                </div>
                <div class="summary-item"><small>–°—É–º–º–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤:</small>
                    <span class="price-down"
                          th:text="${#numbers.formatInteger(totalReturnsSum, 1, 'WHITESPACE') + ' ÷è'}">0</span>
                </div>
            </div>
            <div class="filter-bar">
                <form method="get" th:action="@{/admin}" class="d-inline-flex gap-2">
                    <input type="hidden" name="activeTab" value="tab-returns">
                    <select name="returnManagerId" onchange="this.form.submit()" class="form-select">
                        <option value="">–í—Å–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã (–í–æ–∑–≤—Ä–∞—Ç—ã)</option>
                        <option th:each="m : ${managers}" th:value="${m}" th:text="${m}"
                                th:selected="${m == selectedReturnManager}"></option>
                    </select>
                </form>
                <button class="btn-primary" onclick="openCreateReturnModal()">+ –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç</button>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ú–µ–Ω–µ–¥–∂–µ—Ä</th>
                        <th>–ú–∞–≥–∞–∑–∏–Ω</th>
                        <th>–ü—Ä–∏—á–∏–Ω–∞</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="r : ${returns}" th:onclick="'openReturnDetails(' + ${r.id} + ')'"
                        style="cursor:pointer;">
                        <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ returnDate -->

                        <td th:with="rd=${r.returnDate}"
                            th:text="${rd != null ? #strings.replace((rd.length() > 16 ? #strings.substring(rd, 0, 16) : rd), 'T', ' ') : ''}">
                        </td>


                        <td th:unless="${r.returnDate != null}"></td>

                        <td th:text="${r.managerId}"></td>
                        <td th:text="${r.shopName}"></td>

                        <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: EXPIRED -> –ü—Ä–æ—Å—Ä–æ—á–∫–∞ -->
                        <td th:text="${r.returnReason != null && r.returnReason.toString() == 'EXPIRED' ? '–ü—Ä–æ—Å—Ä–æ—á–∫–∞' : (r.returnReason != null ? r.returnReason : '')}"></td>

                        <td class="price-down"
                            th:text="${#numbers.formatInteger(r.totalAmount, 1, 'WHITESPACE') + ' ÷è'}"></td>

                        <td>
                            <span th:class="'badge ' + (${r.status} == 'CONFIRMED' ? 'bg-success text-white' : 'bg-warning')"
                                  th:text="${r.status}"></span>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- –í–ö–õ–ê–î–ö–ê –ö–õ–ò–ï–ù–¢–´ -->
        <div id="tab-clients" class="tab-pane">
            <div class="filter-bar">
                <input type="text" id="search-clients" onkeyup="filterTable('search-clients', 'clients-table-body')"
                       placeholder="üîé –ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ –∏–ª–∏ –∞–¥—Ä–µ—Å–∞..." class="form-control w-25">
                <button class="btn-primary" onclick="openModal('modal-client')">+ –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
            </div>
            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th>–ú–∞–≥–∞–∑–∏–Ω</th>
                        <th>–ê–¥—Ä–µ—Å</th>
                        <th>–î–æ–ª–≥</th>
                    </tr>
                    </thead>
                    <tbody id="clients-table-body">
                    <tr th:each="c : ${clients}" th:onclick="'openClientDetails(' + ${c.id} + ')'"
                        style="cursor:pointer;">
                        <td th:text="${c.name}" style="font-weight:700;"></td>
                        <td th:text="${c.address}"></td>
                        <td class="price-down" th:text="${#numbers.formatInteger(c.debt, 1, 'WHITESPACE') + ' ÷è'}"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- –í–ö–õ–ê–î–ö–ê –°–ö–õ–ê–î -->
        <div id="tab-products" class="tab-pane">
            <div class="filter-bar">
                <input type="text" id="search-products" onkeyup="filterTable('search-products', 'products-table-body')"
                       placeholder="üîé –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞ –∏–ª–∏ —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞..."
                       style="padding:8px; border-radius:8px; border:1px solid #ddd; flex-grow:1; margin-right:10px;">
                <button class="btn-primary" onclick="openModal('modal-product-create-new')">+ –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä</button>
            </div>
            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th>–¢–æ–≤–∞—Ä</th>
                        <th>–¶–µ–Ω–∞</th>
                        <th>–û—Å—Ç–∞—Ç–æ–∫</th>
                        <th>–£–ø–∞–∫.</th>
                        <th>–®—Ç—Ä–∏—Ö-–∫–æ–¥</th>
                        <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                    </tr>
                    </thead>
                    <tbody id="products-table-body">
                    <tr th:each="p : ${products}" th:onclick="'openProductDetails(' + ${p.id} + ')'"
                        style="cursor:pointer;">
                        <td th:text="${p.name}" style="font-weight:600"></td>
                        <td th:text="${#numbers.formatInteger(p.price, 1, 'WHITESPACE') + ' ÷è'}"></td>
                        <td th:text="${p.stockQuantity + ' —à—Ç.'}"></td>
                        <td th:text="${p.itemsPerBox}"></td>
                        <td th:text="${p.barcode}"></td>
                        <td>
                            <button class="btn-primary" style="padding:5px 10px;"
                                    th:onclick="'event.stopPropagation(); editProduct(' + ${p.id} + ')'">–ò–∑–º–µ–Ω–∏—Ç—å
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="tab-main" class="tab-pane">
            <div class="row g-3">
                <!-- 1. –ë–ª–æ–∫ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
                <div class="col-md-4">
                    <div class="summary-card"
                         style="background: white; flex-direction: column; align-items: flex-start; gap: 10px; height: 100%;">
                        <h5 style="color: var(--text-muted); font-size: 14px; margin: 0;">üìä –ü–û–ö–ê–ó–ê–¢–ï–õ–ò –°–ï–ì–û–î–ù–Ø</h5>
                        <div style="font-size: 20px; font-weight: 800; margin-top: 10px;">
                            –°—Ä–µ–¥–Ω–∏–π —á–µ–∫: <span class="price-up" id="stat-avg-check">0 ÷è</span>
                        </div>
                        <div style="font-size: 16px;">
                            –ó–∞–∫–∞–∑–æ–≤ –≤ –æ–∂–∏–¥–∞–Ω–∏–∏: <b id="stat-pending-orders">0</b>
                        </div>
                    </div>
                </div>

                <!-- 2. –ë–ª–æ–∫ –ò–º–ø–æ—Ä—Ç–∞ -->
                <div class="col-md-4">
                    <div class="summary-card"
                         style="background: white; flex-direction: column; align-items: flex-start; gap: 10px; height: 100%;">
                        <h5 style="color: var(--text-muted); font-size: 14px; margin: 0;">üîå –ò–ú–ü–û–†–¢ –î–ê–ù–ù–´–•
                            (Excel/1C)</h5>
                        <div style="width: 100%; display: flex; flex-direction: column; gap: 8px; margin-top: 10px;">
                            <button class="btn-primary" style="width: 100%; background: #6366f1;"
                                    onclick="triggerImport()">
                                –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏—Ö–æ–¥ —Ç–æ–≤–∞—Ä–∞
                            </button>
                            <button class="btn-primary" style="width: 100%; background: #64748b;"
                                    onclick="exportInventory()">
                                –í—ã–≥—Ä—É–∑–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 3. –ë–ª–æ–∫ "–ö—Ç–æ –≤ —Å–µ—Ç–∏" -->
                <div class="col-md-4">
                    <div class="summary-card"
                         style="background: white; flex-direction: column; align-items: flex-start; gap: 10px; height: 100%;">
                        <h5 style="color: var(--text-muted); font-size: 14px; margin: 0;">üü¢ –°–ï–ô–ß–ê–° –í –°–ò–°–¢–ï–ú–ï</h5>
                        <div id="online-users-list"
                             style="display: flex; flex-direction: column; gap: 5px; margin-top: 10px; width: 100%;">
                            <span class="badge" style="background: #dcfce7; color: #166534; width: fit-content;">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–í—ã)</span>
                        </div>
                    </div>
                </div>
            </div> <!-- –ö–æ–Ω–µ—Ü row g-3 -->

            <!-- –°–µ–∫—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã (–ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è) –∏–¥–µ—Ç –°–†–ê–ó–£ –ø–æ—Å–ª–µ row -->
            <div class="table-container" style="margin-top: 25px;">
                <h5 style="padding: 15px; margin: 0; border-bottom: 1px solid var(--border); font-size: 15px; font-weight: 700;">
                    –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è (–ò–º–ø–æ—Ä—Ç)
                </h5>
                <table class="table">
                    <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                        <th>–î–µ—Ç–∞–ª–∏</th>
                    </tr>
                    </thead>
                    <tbody id="import-log-body">
                    <!-- –í 2026 –¥–∞–Ω–Ω—ã–µ —Å—é–¥–∞ –ø–æ–¥—Ç—è–Ω—É—Ç—Å—è —á–µ—Ä–µ–∑ Thymeleaf –∏–ª–∏ JS –∏–∑ AuditLog -->
                    <tr th:each="log : ${auditLogs}">
                        <td th:text="${#temporals.format(log.timestamp, 'dd.MM.yyyy HH:mm')}"></td>
                        <td th:text="${log.action}"></td>
                        <td th:text="${log.details}"></td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(auditLogs)}">
                        <td colspan="3" style="text-align:center; color: var(--text-muted); padding: 20px;">–ò—Å—Ç–æ—Ä–∏—è
                            –ø—É—Å—Ç–∞
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>


        <div id="modal-order-view" class="modal">
            <div class="modal-content">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                    <h2 id="modal-title" style="margin: 0;">–î–µ—Ç–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏</h2>
                    <button onclick="closeModal('modal-order-view')"
                            style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;
                    </button>
                </div>
                <div id="order-info">
                    <!--                     style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; background: #f8fafc; padding: 15px; border-radius: 10px; margin-top: 20px; flex-shrink: 0;">-->

                </div>
                <div id="table-scroll-container">
                    <table class="table">
                        <thead>
                        <tr>
                            <th>–¢–æ–≤–∞—Ä</th>
                            <th>–ö–æ–ª-–≤–æ</th>
                            <th>–¶–µ–Ω–∞</th>
                            <th>–ò—Ç–æ–≥–æ</th>
                            <th>–ö–∞—Ç.</th>
                        </tr>
                        </thead>
                        <tbody id="order-items-body"></tbody>
                    </table>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto; padding-top: 20px; border-top: 2px solid #eee; flex-shrink: 0;">
                    <div id="order-total-price" style="font-size: 20px; font-weight: 800; color: var(--accent);"></div>
                    <div id="order-footer-actions" style="display: flex; gap: 10px;"></div>
                </div>
            </div>
        </div>


        <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–ï–¢–ê–õ–ï–ô –ö–õ–ò–ï–ù–¢–ê (–ù–û–í–û–ï) -->
        <div id="modal-client-view" class="modal">
            <div class="modal-content">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                    <h2 id="modal-client-title" style="margin: 0;">–î–µ—Ç–∞–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞</h2>
                    <button onclick="closeModal('modal-client-view')"
                            style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;
                    </button>
                </div>
                <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, —Å—Ç–∏–ª–∏ —É–∂–µ –≥–æ—Ç–æ–≤—ã -->
                <div id="client-info">
                    <!--                     style="display: grid; gap: 15px; background: #f8fafc; padding: 15px; border-radius: 10px; margin-top: 10px; flex-shrink: 0;"-->

                </div>

                <!-- –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –∑–∞–∫–∞–∑–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ. –ü–æ–∫–∞ –æ—Å—Ç–∞–≤–∏–º –ø—É—Å—Ç–æ -->
                <div id="table-scroll-container-client" style="flex-grow: 1; overflow-y: auto; margin: 10px 0;">
                    <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>

                <div id="client-footer-actions"
                     style="display: flex; justify-content: flex-end; align-items: center; margin-top: auto; padding-top: 10px; border-top: 2px solid #eee; flex-shrink: 0; gap: 10px;">
                    <button class="btn-primary" onclick="enableClientEdit()">–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                    <button class="btn-primary" style="background:#64748b" onclick="closeModal('modal-client-view')">
                        –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>
            </div>
        </div>
        <div id="modal-client" class="modal">
            <div class="modal-content" style="width: 500px;">
                <h2 style="margin-bottom:20px;">üë§ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞</h2>
                <!-- –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ Java-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä /admin/clients/create -->
                <form th:action="@{/admin/clients/create}" method="post">
                    <div class="modal-info-row">
                        <div>
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞</label><input type="text" name="name" required
                                                                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ó–û–í–ö –ü–∞–ø–∞–∑—è–Ω">
                            <label>–í–ª–∞–¥–µ–ª–µ—Ü / –ò–ü</label><input type="text" name="ownerName" placeholder="–§–ò–û –í–ª–∞–¥–µ–ª—å—Ü–∞">
                            <label>–ò–ù–ù</label><input type="text" name="inn" placeholder="–ò–ù–ù">
                        </div>
                    </div>
                    <div class="modal-info-row" style="margin-top:10px;">
                        <div>
                            <label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input type="text" name="phone" placeholder="+374 XX XX XX">
                            <label>–ê–¥—Ä–µ—Å</label><input type="text" name="address" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏">
                            <label>–î–µ–Ω—å –º–∞—Ä—à—Ä—É—Ç–∞</label><input type="text" name="routeDay"
                                                               placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –í—Ç–æ—Ä–Ω–∏–∫">
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 25px; justify-content: flex-end;">
                        <button type="submit" class="btn-primary" style="background:#10b981">–°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
                        <button type="button" class="btn-primary" style="background:#64748b"
                                onclick="closeModal('modal-client')">–û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </form>
            </div>
        </div>


        <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–ï–¢–ê–õ–ï–ô –¢–û–í–ê–†–ê (–ù–û–í–û–ï) -->
        <div id="modal-product-view" class="modal">
            <div class="modal-content">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                    <h2 id="modal-product-title" style="margin: 0;">–î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞</h2>
                    <button onclick="closeModal('modal-product-view')"
                            style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;
                    </button>
                </div>

                <div id="product-info">
                    <!--                     style="display: grid; gap: 15px; background: #f8fafc; padding: 15px; border-radius: 10px; margin-top: 10px; flex-shrink: 0;">-->


                </div>

                <div id="product-footer-actions"
                     style="display: flex; justify-content: flex-end; align-items: center; margin-top: auto; padding-top: 10px; border-top: 2px solid #eee; flex-shrink: 0; gap: 10px;">
                    <button class="btn-primary" onclick="enableProductEdit()">–ò–∑–º–µ–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
                    <button class="btn-primary" style="background:#64748b" onclick="closeModal('modal-product-view')">
                        –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>
            </div>
        </div>

        <div id="modal-payment" class="modal">
            <div class="modal-content" style="width: 400px;">
                <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–ø–ª–∞—Ç—ã</h3>
                <input type="hidden" id="pay-invoice-id">
                <label>–°—É–º–º–∞ –æ–ø–ª–∞—Ç—ã (÷è)</label>
                <input type="number" id="pay-amount" class="form-control">
                <label style="margin-top:10px;">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                <select id="pay-comment" class="form-control">
                    <option value="–ù–∞–ª–∏—á–Ω—ã–µ">–ù–∞–ª–∏—á–Ω—ã–µ</option>
                    <option value="–ü–µ—Ä–µ–≤–æ–¥">–ü–µ—Ä–µ–≤–æ–¥</option>
                </select>
                <div style="margin-top:20px; display:flex; gap:10px;">
                    <button class="btn-primary" onclick="submitPayment()" style="flex:1">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                    <button class="btn-primary" style="background:#64748b" onclick="closeModal('modal-payment')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>

        <div id="modal-product-create-new" class="modal">
            <div class="modal-content" style="width: 500px;">
                <h2 style="margin-bottom:20px;">üì¶ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞</h2>
                <div class="modal-info-row">
                    <div style="flex:1">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" id="new-p-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
                        <label>–¶–µ–Ω–∞ (÷è)</label><input type="number" id="new-p-price" placeholder="0">
                        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label><input type="text" id="new-p-cat" placeholder="–ù–∞–ø–∏—Ç–∫–∏, –ï–¥–∞...">
                    </div>
                </div>
                <div class="modal-info-row" style="margin-top:10px;">
                    <div style="flex:1">
                        <label>–û—Å—Ç–∞—Ç–æ–∫</label><input type="number" id="new-p-qty" value="0">
                        <label>–®—Ç—Ä–∏—Ö-–∫–æ–¥</label><input type="text" id="new-p-code" placeholder="000000">
                        <label>–í –∫–æ—Ä–æ–±–∫–µ</label><input type="number" id="new-p-box" value="1">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 25px; justify-content: flex-end;">
                    <button class="btn-primary" onclick="submitCreateProduct()" style="background:#10b981">–°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä
                    </button>
                    <button class="btn-primary" style="background:#64748b"
                            onclick="closeModal('modal-product-create-new')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>

        <div id="tab-users" class="tab-pane">
            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th>–õ–æ–≥–∏–Ω</th>
                        <th>–§–ò–û</th>
                        <th>–†–æ–ª—å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="u : ${users}">
                        <td th:text="${u.username}"></td>
                        <td th:text="${u.fullName}"></td>
                        <td><span class="badge" th:text="${u.role}"></span></td>
                        <td>
                            <button class="btn-warning" th:onclick="'resetPassword(' + ${u.id} + ')'">
                                –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è (1111)
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <script>
            // –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –≤–æ —Ñ—Ä–µ–π–º–µ, –æ–Ω–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—Å—è.
            // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –æ–Ω–∞ —Å–∞–º–∞ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–ª–∞ –ø–µ—á–∞—Ç—å:
            window.onload = function() {
                if (window.self !== window.top) {
                    // –ú—ã –≤–Ω—É—Ç—Ä–∏ iframe, –∂–¥–µ–º –∫–æ–º–∞–Ω–¥—É –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è
                } else {
                    window.print(); // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª–∏ –≤—Ä—É—á–Ω—É—é –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
                }
            }
        </script>

        <script th:inline="javascript">
            const fmt = (s) => {
                if (!s || typeof s !== 'string') return s;
                let clean = s.replace('T', ' ');
                return clean.length > 16 ? clean.substring(0, 16) : clean;
            };

            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ null —á–µ—Ä–µ–∑ Thymeleaf (—Å—Ç–∞–Ω–¥–∞—Ä—Ç 2026)
            const ordersData = /*[[${orders}]]*/ [];
            const returnsData = /*[[${returns}]]*/ [];
            const productsData = /*[[${products}]]*/ [];
            const clientsData = /*[[${clients}]]*/ [];
            const usersData = /*[[${users}]]*/ [];
            const paymentMethods = /*[[${paymentMethods}]]*/ [];
            const returnReasons = /*[[${returnReasons}]]*/ [];
        </script>

        <script th:src="@{/js/script.js}"></script>

        <iframe id="printFrame" style="display:none;"></iframe>
        <div id="toast-container" style="position: fixed; top: 20px; right: 20px; z-index: 9999;"></div>
    </div>
</div>

</body>

</html>
