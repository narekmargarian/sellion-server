<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Sellion ERP 2026</title>
    <link rel="icon" type="image/x-icon" th:href="@{/img/favicon.ico}">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com" rel="stylesheet">

    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<div class="sidebar">
    <div class="brand">SELLION 2026</div>
    <div sec:authorize="hasRole('ADMIN')" onclick="showTab('tab-main')" class="nav-link" id="btn-main">
        <i class="bi bi-speedometer2"></i> –û–±–∑–æ—Ä
    </div>

    <div onclick="showTab('tab-orders')" class="nav-link" id="btn-orders"><i class="bi bi-cart"></i> –ó–∞–∫–∞–∑—ã</div>
    <div onclick="showTab('tab-returns')" class="nav-link" id="btn-returns"><i class="bi bi-arrow-counterclockwise"></i>
        –í–æ–∑–≤—Ä–∞—Ç—ã
    </div>
    <div onclick="showTab('tab-delivery')" class="nav-link" id="btn-delivery"><i class="bi bi-truck"></i> –î–æ—Å—Ç–∞–≤–∫–∞</div>
    <div onclick="showTab('tab-clients')" class="nav-link" id="btn-clients"><i class="bi bi-people"></i> –ö–ª–∏–µ–Ω—Ç—ã</div>
    <div onclick="showTab('tab-promos')" class="nav-link" id="btn-promos">
        <i class="bi bi-megaphone"></i> –ê–∫—Ü–∏–∏
    </div>


    <div sec:authorize="hasRole('ADMIN')" onclick="showTab('tab-managers')" class="nav-link" id="btn-managers">
        <i class="bi bi-person-badge-fill"></i> –ú–µ–Ω–µ–¥–∂–µ—Ä—ã
    </div>

    <div onclick="showTab('tab-products')" class="nav-link" id="btn-products"><i class="bi bi-box-seam"></i> –°–∫–ª–∞–¥</div>

    <div onclick="showTab('tab-invoices')" class="nav-link"
         id="btn-invoices">
        <i class="bi bi-file-earmark-text"></i> –°—á–µ—Ç–∞ / –û–ø–ª–∞—Ç–∞
    </div>
    <div onclick="showTab('tab-reports')" class="nav-link"
         id="btn-reports">
        <i class="bi bi-graph-up"></i> –û—Ç—á–µ—Ç—ã
    </div>

    <div sec:authorize="hasRole('ADMIN')" onclick="showTab('tab-imports')" class="nav-link" id="btn-imports"><i
            class="bi bi-cloud-arrow-up"></i> –ò–º–ø–æ—Ä—Ç
    </div>
    <div sec:authorize="hasRole('ADMIN')" onclick="showTab('tab-users')" class="nav-link" id="btn-users"><i
            class="bi bi-shield-lock"></i> –ü–µ—Ä—Å–æ–Ω–∞–ª
    </div>
    <div sec:authorize="hasRole('ADMIN')" onclick="showTab('tab-settings')" class="nav-link" id="btn-settings"><i
            class="bi bi-gear"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    </div>


    <form id="logout-form" th:action="@{/logout}" method="post" style="margin-top:auto; padding:20px;">
        <!-- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π CSRF —Ç–æ–∫–µ–Ω –±–µ–∑ –ª–∏—à–Ω–∏—Ö –∫–∞–≤—ã—á–µ–∫ -->
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

        <button type="button"
                onclick="handleLogout()"
                style="width:100%; background:#ef4444; color:white; border:none; padding:10px; border-radius:8px; cursor:pointer; font-weight:700;">
            –í–´–•–û–î
        </button>
    </form>

</div>

<div class="main">
    <div class="scroll-area">

        <div id="tab-orders" class="tab-pane">
            <div class="summary-card">
                <div class="summary-item">
                    <small>–ó–∞–∫–∞–∑–æ–≤ –≤—Å–µ–≥–æ:</small>
                    <span th:text="${totalOrdersCount ?: 0}">0</span>
                </div>
                <div class="summary-item">
                    <small>–û–±—â–∞—è —Å—É–º–º–∞:</small>
                    <span class="price-up"
                          th:with="val=${totalOrdersSum != null ? totalOrdersSum.doubleValue() : 0}"
                          th:text="${val == 0 ? '0 ÷è' : (val % 1 == 0 ? #numbers.formatInteger(val, 1, 'WHITESPACE') : #numbers.formatDecimal(val, 1, 'WHITESPACE', 2, 'POINT').replaceAll('0$', '')) + ' ÷è'}">
        0 ÷è
    </span>
                </div>
            </div>

            <div class="filter-bar">
                <input type="text" id="search-orders" onkeyup="filterTable('search-orders', 'orders-table-body')"
                       placeholder="–ü–æ–∏—Å–∫ –ø–æ –º–∞–≥–∞–∑–∏–Ω—É..." class="form-control w-25">

                <form method="get" th:action="@{/admin}" class="d-inline-flex gap-2 align-items-center">
                    <input type="hidden" name="activeTab" value="tab-orders">
                    <small>–°:</small>
                    <input type="date" name="orderStartDate" class="form-control" th:value="${orderStartDate}">
                    <small>–ü–æ:</small>
                    <input type="date" name="orderEndDate" class="form-control" th:value="${orderEndDate}">
                    <select name="orderManagerId" onchange="this.form.submit()" class="form-select">
                        <option value="">–í—Å–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã</option>
                        <option th:each="m : ${managers}" th:value="${m}" th:text="${m}"
                                th:selected="${m == selectedOrderManager}"></option>
                    </select>
                    <button type="submit" class="btn-primary" title="–û–±–Ω–æ–≤–∏—Ç—å">‚ü≥</button>
                    <button type="button" class="btn-primary" onclick="printSelectedOperations('order')"
                            title="–ü–µ—á–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö">‚éô
                    </button>
                </form>

                <button type="button" class="btn-primary"
                        style="background: #10b981;"
                        onclick="printCompactOrders()"
                        title="–ü–µ—á–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö (–ö–æ–º–ø–∞–∫—Ç)">
                    üìÑ
                </button>

                <button class="btn-primary" onclick="openCreateOrderModal()" title="–ù–æ–≤—ã–π –∑–∞–∫–∞–∑">+</button>
                <button type="button" class="btn-primary"
                        onclick="printDailySummary()"
                        title="–°–≤–æ–¥–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞ –¥–µ–Ω—å">
                    üìã
                </button>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th style="width: 40px;">
                            <input type="checkbox" onclick="toggleSelectAll('order-print-check', this)"
                                   style="cursor:pointer;">
                        </th>
                        <th>–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</th>
                        <th>–ú–µ–Ω–µ–¥–∂–µ—Ä</th>
                        <th>–ú–∞–≥–∞–∑–∏–Ω</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–î–æ—Å—Ç–∞–≤–∫–∞</th>
                        <th>–ê–≤—Ç–æ</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                    </tr>
                    </thead>
                    <tbody id="orders-table-body">
                    <tr th:each="o : ${orders}" th:data-id="${o.id}"
                        onclick="if(!event.target.closest('button, input')){ openOrderDetails(this.getAttribute('data-id')) }">
                        <td onclick="event.stopPropagation()">
                            <input type="checkbox" class="order-print-check" th:value="${o.id}">
                        </td>

                        <td class="js-date-format" th:text="${o.createdAt}"></td>
                        <td th:text="${o.managerId}" style="font-weight:600; color:var(--accent);"></td>
                        <td th:text="${o.shopName}" style="font-weight:700;"></td>
                        <td class="price-up">
    <span th:with="val=${o.totalAmount != null ? o.totalAmount.doubleValue() : 0}"
          th:text="${val == 0 ? '0 ÷è' : (val % 1 == 0 ? #numbers.formatInteger(val, 1, 'WHITESPACE') : #numbers.formatDecimal(val, 1, 'WHITESPACE', 2, 'POINT').replaceAll('0$', '')) + ' ÷è'}">
        0 ÷è
    </span>
                        </td>


                        <td class="js-date-format" th:text="${o.deliveryDate}"></td>

                        <td><b th:text="${o.carNumber ?: '---'}" style="color: #64748b;"></b></td>

                        <td>
                            <th:block th:if="${o.shopName == '–°–ü–ò–°–ê–ù–ò–ï'}">
                                <span class="badge bg-secondary">–°–ü–ò–°–ê–ù–û</span>
                            </th:block>
                            <th:block th:unless="${o.shopName == '–°–ü–ò–°–ê–ù–ò–ï'}">
                        <span th:class="|badge ${o.invoiceId != null ? 'bg-success' : (o.status.name() == 'RESERVED' ? 'bg-info' : 'bg-primary')}|"
                              th:text="${o.invoiceId != null ? '–ü–†–û–í–ï–†–ï–ù–û' : (o.status.name() == 'RESERVED' ? '–í —Ä–µ–∑–µ—Ä–≤–µ' : '–ù–æ–≤—ã–π')}">
                        </span>
                            </th:block>
                            <br/>
                            <small class="text-muted"
                                   th:text="${o.paymentMethod != null ? o.paymentMethod.displayName : ''}"></small>
                        </td>

                        <td onclick="event.stopPropagation()">
                            <div style="display: flex; gap: 5px;">
                                <th:block th:if="${o.shopName != '–°–ü–ò–°–ê–ù–ò–ï'}">
                                    <th:block th:if="${o.invoiceId == null}">
                                        <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–±—Ä–∞–Ω–∞ —Ñ–æ—Ä–º–∞. –¢–µ–ø–µ—Ä—å –∫–Ω–æ–ø–∫–∞ –≤—ã–∑—ã–≤–∞–µ—Ç JS —Ñ—É–Ω–∫—Ü–∏—é -->
                                        <button type="button" class="btn-primary"
                                                th:onclick="'handleCreateInvoice(' + ${o.id} + ')'"
                                                style="padding:5px 10px; font-size:11px; background:#10b981; border:none; border-radius:4px; cursor:pointer;">
                                            –°—á–µ—Ç
                                        </button>

                                        <button type="button" class="btn-primary"
                                                th:onclick="'showConfirmModal(\'–£–¥–∞–ª–µ–Ω–∏–µ\', \'–£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑?\', () => cancelOrder(' + ${o.id} + '))'"
                                                style="padding:5px 10px; font-size:11px; background:#ef4444; border:none; border-radius:4px; cursor:pointer; margin-left:5px;">
                                            ‚ùå
                                        </button>
                                    </th:block>

                                    <span th:if="${o.invoiceId != null}" class="badge bg-light text-dark"
                                          style="border:1px solid #ccc; padding: 7px; border-radius:4px;">
                                                     –°—á–µ—Ç ‚Ññ[[${o.invoiceId}]]
                                                             </span>
                                </th:block>


                                <th:block th:if="${o.shopName == '–°–ü–ò–°–ê–ù–ò–ï'}">
                                    <small class="text-muted">–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Å–∫–ª–∞–¥–∞</small>
                                </th:block>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="pagination-wrapper" th:if="${totalPages > 1}"
                 style="
                 margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                <a th:href="@{/admin(activeTab='tab-orders', page=${currentPage - 1}, orderStartDate=${orderStartDate}, orderEndDate=${orderEndDate})}"
                   th:if="${currentPage > 0}" class="btn-ghost">‚Üê –ù–∞–∑–∞–¥</a>
                <span style="align-self: center; font-weight: 700;">
            –°—Ç—Ä–∞–Ω–∏—Ü–∞ <span th:text="${currentPage + 1}"></span> –∏–∑ <span th:text="${totalPages}"></span>
        </span>
                <a th:href="@{/admin(activeTab='tab-orders', page=${currentPage + 1}, orderStartDate=${orderStartDate}, orderEndDate=${orderEndDate})}"
                   th:if="${currentPage < totalPages - 1}" class="btn-ghost">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
            </div>
        </div>


        <div id="tab-invoices" class="tab-pane">

            <!-- –ö–ê–†–¢–û–ß–ö–ò –°–¢–ê–¢–ò–°–¢–ò–ö–ò (–î–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è –∏–ª–∏ –ø–µ—Ä–∏–æ–¥) -->
            <div class="summary-card" style="background: #f0fdf4; border-color: #bbf7d0; display: flex; gap: 20px;">
                <div class="summary-item">
                    <small>–û–±—â–∏–π –¥–æ–ª–≥ —Å–∏—Å—Ç–µ–º—ã:</small><br>
                    <span class="price-down"
                          th:with="val=${totalInvoiceDebt != null ? totalInvoiceDebt.doubleValue() : 0}"
                          th:text="${(val == 0) ? '0 ÷è' : ((val % 1 == 0) ? #numbers.formatInteger(val, 1, 'WHITESPACE') : #numbers.formatDecimal(val, 1, 'WHITESPACE', 2, 'POINT').replaceAll('0$', '')) + ' ÷è'}">
        </span>
                </div>
                <div class="summary-item">
                    <small>–í—Å–µ–≥–æ –æ–ø–ª–∞—á–µ–Ω–æ:</small><br>
                    <span class="price-up"
                          th:with="val=${totalPaidSum != null ? totalPaidSum.doubleValue() : 0}"
                          th:text="${(val == 0) ? '0 ÷è' : ((val % 1 == 0) ? #numbers.formatInteger(val, 1, 'WHITESPACE') : #numbers.formatDecimal(val, 1, 'WHITESPACE', 2, 'POINT').replaceAll('0$', '')) + ' ÷è'}">
        </span>
                </div>
            </div>


            <!-- –ë–ê–† –§–ò–õ–¨–¢–†–û–í -->
            <div class="filter-bar">
                <input type="text" id="search-invoices" onkeyup="filterTable('search-invoices', 'invoices-table-body')"
                       placeholder="–ü–æ–∏—Å–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ..." class="form-control" style="width: 150px;">

                <!-- –°–µ–ª–µ–∫—Ç–æ—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—ã–±–æ—Ä–∞) -->
                <select id="filter-invoice-manager" class="form-select" style="width: 150px;"
                        onchange="applyInvoiceFilters()">
                    <option value="">–í—Å–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã</option>
                    <option th:each="m : ${managers}" th:value="${m}" th:text="${m}"
                            th:selected="${m == selectedInvManager}"></option>
                </select>

                <!-- –°–µ–ª–µ–∫—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ (—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—ã–±–æ—Ä–∞) -->
                <select id="filter-invoice-status" class="form-select" style="width: 150px;"
                        onchange="applyInvoiceFilters()">
                    <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    <option value="–û–ø–ª–∞—á–µ–Ω" th:selected="${selectedInvStatus == '–û–ø–ª–∞—á–µ–Ω'}">–û–ø–ª–∞—á–µ–Ω</option>
                    <option value="–ß–∞—Å—Ç–∏—á–Ω–æ" th:selected="${selectedInvStatus == '–ß–∞—Å—Ç–∏—á–Ω–æ'}">–ß–∞—Å—Ç–∏—á–Ω–æ</option>
                    <option value="–ù–µ –û–ø–ª–∞—á–µ–Ω" th:selected="${selectedInvStatus == '–ù–µ –û–ø–ª–∞—á–µ–Ω'}">–ù–µ –û–ø–ª–∞—á–µ–Ω</option>
                </select>

                <!-- –î–∞—Ç—ã -->
                <div class="d-flex gap-1">
                    <input type="date" id="inv-date-start" class="form-control" style="width: 135px;"
                           th:value="${invoiceStart}">
                    <input type="date" id="inv-date-end" class="form-control" style="width: 135px;"
                           th:value="${invoiceEnd}">
                    <button class="btn-primary" onclick="applyInvoiceFilters()">‚ü≥ –§–∏–ª—Ç—Ä</button>
                </div>

                <!-- –ö–ù–û–ü–ö–ê –ü–ï–ß–ê–¢–ò (–í–µ—Ä–Ω—É–ª –Ω–∞–∑–∞–¥) -->
                <button class="btn-primary" onclick="printManagerDebts()" style="background: #1e293b;">
                    ‚éô –õ–∏—Å—Ç –¥–æ–ª–≥–æ–≤
                </button>
            </div>


            <!-- –¢–ê–ë–õ–ò–¶–ê -->
            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th>‚Ññ –°—á–µ—Ç–∞</th>
                        <th>–ú–∞–≥–∞–∑–∏–Ω</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–û–ø–ª–∞—á–µ–Ω–æ</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                    </tr>
                    </thead>
                    <tbody id="invoices-table-body">
                    <tr th:each="inv : ${invoices}" th:data-manager="${inv.managerId}">
                        <td th:text="${inv.invoiceNumber}"></td>
                        <td th:text="${inv.shopName}" style="font-weight:700;"></td>
                        <td th:text="${#numbers.formatDecimal(inv.totalAmount, 1, 'WHITESPACE', 2, 'POINT') + ' ÷è'}"></td>
                        <td class="price-up">
    <span th:with="val=${inv.paidAmount != null ? inv.paidAmount.doubleValue() : 0}"
          th:text="${(val == 0) ? '0 ÷è' : ((val % 1 == 0) ? #numbers.formatInteger(val, 1, 'WHITESPACE') : #numbers.formatDecimal(val, 1, 'WHITESPACE', 2, 'POINT').replaceAll('0$', '')) + ' ÷è'}">
    </span>
                        </td>


                        <td>
                    <span th:with="isFullyPaid=(${inv.paidAmount} >= ${inv.totalAmount}),
                                   isPartial=(${inv.paidAmount} > 0 and ${inv.paidAmount} < ${inv.totalAmount})"
                          th:class="|badge ${isFullyPaid ? 'bg-success text-white' : (isPartial ? 'bg-info text-dark' : 'bg-warning text-dark')}|"
                          th:text="${isFullyPaid ? '–û–ø–ª–∞—á–µ–Ω' : (isPartial ? '–ß–∞—Å—Ç–∏—á–Ω–æ' : '–ù–µ –û–ø–ª–∞—á–µ–Ω')}">
                    </span>
                        </td>
                        <td>
                            <div style="display: flex; gap: 5px;">
                                <button class="btn-primary" style="padding:5px;"
                                        th:onclick="'openPaymentModal(' + ${inv.id} + ')'">üí≥ –û–ø–ª–∞—Ç–∞
                                </button>
                                <button class="btn-primary" style="background:#64748b; padding:5px;"
                                        th:onclick="'printInvoiceInline(' + ${inv.id} + ')'">üñ® –ü–µ—á–∞—Ç—å
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(invoices)}">
                        <td colspan="6" style="text-align: center; padding: 20px; color: var(--text-muted);">
                            –ó–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Å—á–µ—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="pagination-wrapper" th:if="${invTotalPages > 1}"
                 style="display: flex; flex-direction: column; align-items: center; gap: 5px; margin-top: 15px;">

                <div style="display: flex; gap: 10px; justify-content: center; align-items: center;">
                    <!-- –ù–∞–∑–∞–¥ -->
                    <a th:href="@{/admin(activeTab='tab-invoices', invoicePage=${invCurrentPage - 1}, invoiceStart=${invoiceStart}, invoiceEnd=${invoiceEnd})}"
                       th:if="${invCurrentPage > 0}" class="btn-ghost">‚Üê –ù–∞–∑–∞–¥</a>

                    <!-- –°—á—ë—Ç—á–∏–∫ -->
                    <span style="font-weight: 700; background: #f1f5f9; padding: 5px 15px; border-radius: 20px; font-size: 13px; border: 1px solid #e2e8f0;">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ <span th:text="${invCurrentPage + 1}"></span> –∏–∑ <span th:text="${invTotalPages}"></span>
            </span>

                    <!-- –í–ø–µ—Ä–µ–¥ -->
                    <a th:href="@{/admin(activeTab='tab-invoices', invoicePage=${invCurrentPage + 1}, invoiceStart=${invoiceStart}, invoiceEnd=${invoiceEnd})}"
                       th:if="${invCurrentPage < invTotalPages - 1}" class="btn-ghost">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
                </div>
            </div>

        </div>


        <div id="tab-returns" class="tab-pane">
            <div class="summary-card" style="background: #fff1f2; border-color: #fecdd3;">
                <div class="summary-item">
                    <small>–í–æ–∑–≤—Ä–∞—Ç–æ–≤ –≤—Å–µ–≥–æ:</small>
                    <span th:text="${totalReturnsCount ?: 0}">0</span>
                </div>
                <div class="summary-item">
                    <small>–°—É–º–º–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤:</small>
                    <span class="price-down"
                          th:with="val=${totalReturnsSum != null ? totalReturnsSum.doubleValue() : 0}"
                          th:text="${val == 0 ? '0 ÷è' : (val % 1 == 0 ? #numbers.formatInteger(val, 1, 'WHITESPACE') : #numbers.formatDecimal(val, 1, 'WHITESPACE', 2, 'POINT').replaceAll('0$', '')) + ' ÷è'}">
        0 ÷è
    </span>
                </div>
            </div>

            <div class="filter-bar">
                <input type="text" id="search-returns" onkeyup="filterTable('search-returns', 'returns-table-body')"
                       placeholder="–ü–æ–∏—Å–∫ –ø–æ –≤–æ–∑–≤—Ä–∞—Ç—É..." class="form-control w-25">

                <form method="get" th:action="@{/admin}" class="d-inline-flex gap-2 align-items-center">
                    <input type="hidden" name="activeTab" value="tab-returns">

                    <small>–°:</small>
                    <input type="date" name="returnStartDate" class="form-control" th:value="${returnStartDate}">
                    <small>–ü–æ:</small>
                    <input type="date" name="returnEndDate" class="form-control" th:value="${returnEndDate}">

                    <select name="returnManagerId" onchange="this.form.submit()" class="form-select">
                        <option value="">–í—Å–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã</option>
                        <option th:each="m : ${managers}" th:value="${m}" th:text="${m}"
                                th:selected="${m == selectedReturnManager}"></option>
                    </select>

                    <button type="submit" class="btn-primary" title="–û–±–Ω–æ–≤–∏—Ç—å">‚ü≥</button>

                    <button type="button" class="btn-primary" onclick="printSelectedOperations('return')"
                            title="–ü–µ—á–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö">üñ®Ô∏è
                    </button>
                </form>

                <button class="btn-primary" onclick="openCreateReturnModal()" title="–ù–æ–≤—ã–π –≤–æ–∑–≤—Ä–∞—Ç">+</button>

                <button type="button" class="btn-primary"
                        style="background: #10b981;"
                        onclick="printCompactReturns()"
                        title="–ü–µ—á–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ (–ö–æ–º–ø–∞–∫—Ç)">
                    üìÑ
                </button>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th style="width: 40px;">
                            <input type="checkbox" onclick="toggleSelectAll('return-print-check', this)"
                                   style="cursor:pointer;">
                        </th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ú–µ–Ω–µ–¥–∂–µ—Ä</th>
                        <th>–ú–∞–≥–∞–∑–∏–Ω</th>
                        <th>–ê–≤—Ç–æ</th>
                        <th>–ü—Ä–∏—á–∏–Ω–∞</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                    </thead>
                    <tbody id="returns-table-body">
                    <tr th:each="r : ${returns}"
                        th:data-id="${r.id}"
                        onclick="openReturnDetails(this.getAttribute('data-id'))"
                        style="cursor:pointer;">

                        <td onclick="event.stopPropagation()">
                            <input type="checkbox" class="return-print-check" th:value="${r.id}"
                                   style="cursor:pointer;">
                        </td>

                        <td class="js-date-format" th:text="${r.createdAt}"></td>
                        <td th:text="${r.managerId}"></td>
                        <td th:text="${r.shopName}"></td>

                        <td><b th:text="${r.carNumber ?: '---'}" style="color: #64748b;"></b></td>

                        <td th:with="rName=${r.returnReason.name()}, isWarehouse=${rName == 'WAREHOUSE' or #strings.contains(rName, 'CORRECTION')}"
                            th:style="${isWarehouse} ? 'color: #059669; font-weight: 800;' : 'color: #dc2626; font-weight: 500;'">

                            <span th:text="${isWarehouse ? 'üîÑ ' : 'üóëÔ∏è '}"></span>
                            <span th:text="${r.returnReason.displayName}"></span>
                        </td>

                        <td class="price-down">
    <span th:with="val=${r.totalAmount != null ? r.totalAmount.doubleValue() : 0}"
          th:text="${val == 0 ? '0 ÷è' : (val % 1 == 0 ? #numbers.formatInteger(val, 1, 'WHITESPACE') : #numbers.formatDecimal(val, 1, 'WHITESPACE', 2, 'POINT').replaceAll('0$', '')) + ' ÷è'}">
        0 ÷è
    </span>
                        </td>

                        <td>
                            <span class="js-status-translate" th:text="${r.status.name()}"></span>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>


        <div id="tab-clients" class="tab-pane">

            <div class="filter-bar">
                <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: –¢–µ–ø–µ—Ä—å –ø–æ–∏—Å–∫ –∏–¥–µ—Ç –ø–æ –≤—Å–µ–π –±–∞–∑–µ —á–µ—Ä–µ–∑ Enter -->
                <input type="text" id="search-clients"
                       th:value="${clientSearch}"
                       onkeypress="if(event.key === 'Enter') applyClientFilters()"
                       placeholder="–ü–æ–∏—Å–∫ (Enter)..." class="form-control w-25">

                <select id="filter-client-category" class="form-select w-25"
                        onchange="applyClientFilters()">
                    <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    <option th:each="cat : ${clientCategories}"
                            th:value="${cat}"
                            th:text="${cat}"
                            th:selected="${cat == selectedCategory}"></option>
                </select>

                <button class="btn-primary" onclick="openCreateClientModal()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th>–ú–∞–≥–∞–∑–∏–Ω</th>
                        <th>–ê–¥—Ä–µ—Å</th>
                        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th> <!-- –ù–û–í–ê–Ø –ö–û–õ–û–ù–ö–ê -->
                        <th>–î–æ–ª–≥</th>
                    </tr>
                    </thead>
                    <tbody id="clients-table-body">
                    <tr th:each="c : ${clients}" th:onclick="'openClientDetails(' + ${c.id} + ')'"
                        style="cursor:pointer;">
                        <td th:text="${c.name}" style="font-weight:700;"></td>
                        <td th:text="${c.address}"></td>
                        <td th:text="${c.category ?: '---'}"></td> <!-- –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –ö–ê–¢–ï–ì–û–†–ò–ò -->

                        <td class="price-down">
    <span th:with="val=${c.debt != null ? c.debt.doubleValue() : 0}"
          th:text="${(val == 0) ? '0 ÷è' : ((val % 1 == 0) ? #numbers.formatInteger(val, 1, 'WHITESPACE') : #numbers.formatDecimal(val, 1, 'WHITESPACE', 2, 'POINT').replaceAll('0$', '')) + ' ÷è'}">
    </span>
                        </td>


                    </tr>
                    </tbody>

                </table>
            </div>

            <!-- –ü–ê–ì–ò–ù–ê–¶–ò–Ø –î–õ–Ø 5000+ –ö–õ–ò–ï–ù–¢–û–í -->
            <div class="pagination-wrapper" th:if="${clientTotalPages > 1}"
                 style="display: flex; flex-direction: column; align-items: center; gap: 5px;">

                <!-- –ò–Ω—Ñ–æ –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ -->
                <small class="text-muted" style="font-size: 11px;">
                    –í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ: <b th:text="${clientTotalElements}">0</b> –∫–ª–∏–µ–Ω—Ç–æ–≤
                </small>

                <div style="display: flex; gap: 10px; justify-content: center; align-items: center;">
                    <!-- –ö–Ω–æ–ø–∫–∞ –ù–ê–ó–ê–î (–î–æ–±–∞–≤–ª–µ–Ω clientSearch) -->
                    <a th:href="@{/admin(activeTab='tab-clients', clientPage=${clientCurrentPage - 1}, clientCategory=${selectedCategory}, clientSearch=${clientSearch})}"
                       th:if="${clientCurrentPage > 0}" class="btn-ghost">‚Üê –ù–∞–∑–∞–¥</a>

                    <!-- –°—á—ë—Ç—á–∏–∫ —Å—Ç—Ä–∞–Ω–∏—Ü -->
                    <span style="font-weight: 700; background: #f1f5f9; padding: 5px 15px; border-radius: 20px; font-size: 13px; border: 1px solid #e2e8f0;">
                     –°—Ç—Ä–∞–Ω–∏—Ü–∞ <span th:text="${clientCurrentPage + 1}"></span> –∏–∑ <span
                            th:text="${clientTotalPages}"></span>
                       </span>

                    <!-- –ö–Ω–æ–ø–∫–∞ –í–ü–ï–†–ï–î (–î–æ–±–∞–≤–ª–µ–Ω clientSearch) -->
                    <a th:href="@{/admin(activeTab='tab-clients', clientPage=${clientCurrentPage + 1}, clientCategory=${selectedCategory}, clientSearch=${clientSearch})}"
                       th:if="${clientCurrentPage < clientTotalPages - 1}" class="btn-ghost">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
                </div>
            </div>

        </div>

        <div id="tab-products" class="tab-pane">
            <div class="filter-bar">
                <input type="text" id="search-products" onkeyup="filterTable('search-products', 'products-table-body')"
                       placeholder="–ü–æ–∏—Å–∫ –ø–æ —Å–∫–ª–∞–¥—É..." class="form-control w-25">
                <button class="btn-primary" onclick="openModal('modal-product-create-new')">+ –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä</button>
                <button class="btn-primary" style="background: #64748b;" onclick="openWriteOffModal()">üóë –°–ø–∏—Å–∞—Ç—å —Ç–æ–≤–∞—Ä
                </button>

            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th style="width: 40%;">–¢–æ–≤–∞—Ä</th>
                        <th>–¶–µ–Ω–∞</th>
                        <th>–û—Å—Ç–∞—Ç–æ–∫</th>
                        <th>–£–ø–∞–∫.</th>
                        <th>–®—Ç—Ä–∏—Ö-–∫–æ–¥</th>
                        <th>–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏</th>
                    </tr>
                    </thead>

                    <tbody id="products-table-body">
                    <tr th:if="${groupedProducts == null or groupedProducts.isEmpty()}">
                        <td colspan="5" style="text-align: center; padding: 30px; color: #94a3b8;">–ù–∞ —Å–∫–ª–∞–¥–µ –ø–æ–∫–∞ –Ω–µ—Ç
                            —Ç–æ–≤–∞—Ä–æ–≤
                        </td>
                    </tr>

                    <th:block th:if="${groupedProducts != null}" th:each="entry, iterStat : ${groupedProducts}">
                        <!-- –£–î–ê–õ–ï–ù onclick, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω colspan -->
                        <tr class="js-category-toggle"
                            th:attr="data-target='cat-' + ${iterStat.index}"
                            style="cursor: pointer; background: #f8fafc; border-bottom: 1px solid #e2e8f0;">

                            <td colspan="6" style="padding: 12px 15px; border-left: 4px solid var(--accent);">
                                <div style="display: flex; justify-content: space-between; align-items: center; pointer-events: none;">
                <span style="font-weight: 800; color: #1e293b; text-transform: uppercase; font-size: 12px;">
                    üìÇ <span th:text="${entry.key}">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</span>
                </span>
                                    <span class="toggle-icon" style="transition: transform 0.3s;">‚ñº</span>
                                </div>
                            </td>
                        </tr>

                        <tr th:each="p : ${entry.value}"
                            th:classappend="'cat-' + ${iterStat.index}"
                            class="product-row-hover"
                            th:onclick="'openProductDetails(' + ${p.id} + ')'"
                            style="cursor:pointer; display: table-row;">

                            <td style="padding-left: 35px;">
                                <div style="font-weight: 600; color: #334155;" th:text="${p.name}">–ù–∞–∑–≤–∞–Ω–∏–µ</div>
                            </td>

                            <td style="font-weight: 700; color: #0f172a;"
                                th:text="${p.price != null ? #numbers.formatDecimal(p.price, 1, 'WHITESPACE', 2, 'POINT') + ' ÷è' : '0 ÷è'}">
                            </td>

                            <td>
                        <span th:with="qty=${p.stockQuantity ?: 0}"
                              th:class="|badge ${qty > 10 ? 'bg-light text-dark' : 'bg-danger text-white'}|"
                              style="padding: 6px 10px; border-radius: 6px;"
                              th:text="${qty + ' —à—Ç.'}">
                        </span>
                            </td>

                            <td th:text="${p.itemsPerBox ?: 1} + ' —à—Ç/—É–ø'"></td>

                            <td class="text-muted" style="font-family: monospace; font-size: 12px;"
                                th:text="${p.barcode ?: '---'}">
                            </td>

                            <td th:class="${p.expiryDate != null and p.expiryDate.isBefore(#temporals.createToday().plusDays(30))} ? 'text-danger fw-bold' : ''"
                                th:text="${p.expiryDate != null ? #temporals.format(p.expiryDate, 'dd.MM.yyyy') : '---'}"></td>
                        </tr>
                    </th:block>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="tab-promos" class="tab-pane">
            <div class="filter-bar">
                <div class="d-flex gap-2 align-items-center">
                    <small>–ü–µ—Ä–∏–æ–¥:</small>
                    <input type="date" id="promo-filter-start" class="form-control" style="width:150px;"
                           th:value="${promoStartDefault}"> <!-- –î–û–ë–ê–í–õ–ï–ù–û -->
                    <input type="date" id="promo-filter-end" class="form-control" style="width:150px;"
                           th:value="${promoEndDefault}">   <!-- –î–û–ë–ê–í–õ–ï–ù–û -->
                    <button class="btn-primary" onclick="loadPromosByPeriod()">üîç –ü–æ–∫–∞–∑–∞—Ç—å</button>
                </div>

                <button class="btn-primary" onclick="openCreatePromoModal()" style="background:#f59e0b">+ –ù–æ–≤–∞—è –ê–∫—Ü–∏—è
                </button>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ –∞–∫—Ü–∏–∏</th>
                        <th>–ú–µ–Ω–µ–¥–∂–µ—Ä</th>
                        <th>–û–¢</th>
                        <th>–î–û</th>
                        <th>–î–Ω–µ–π –æ—Å—Ç–∞–ª–æ—Å—å</th>
                        <th>–¢–æ–≤–∞—Ä–æ–≤</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                    </thead>
                    <tbody id="promos-table-body">
                    <!-- –°—é–¥–∞ JS –æ—Ç—Ä–∏—Å—É–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–∫—Ü–∏–π -->
                    </tbody>
                </table>
            </div>
        </div>


        <div id="tab-managers" class="tab-pane">
            <div class="filter-bar">
                <h4 style="margin: 0; font-weight: 800;">üèÜ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–π</h4>
                <form method="get" th:action="@{/admin}" class="d-inline-flex gap-2">
                    <input type="hidden" name="activeTab" value="tab-managers">
                    <input type="date" name="kpiStart" class="form-control" th:value="${orderStartDate}">
                    <input type="date" name="kpiEnd" class="form-control" th:value="${orderEndDate}">
                    <button type="submit" class="btn-primary">‚ü≥</button>
                </form>

            </div>

            <div class="manager-table-container">
                <div class="managers-grid"
                     style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; margin-top: 20px;">

                    <th:block th:if="${managersKPI != null}" th:each="m : ${managersKPI}">
                        <div class="glass-card" th:with="stats=${managerStats != null ? managerStats.get(m) : null}"
                             style="padding: 20px; border-radius: 16px; border-left: 5px solid var(--accent);">

                            <div style="margin-bottom: 15px;">
                                <h5 style="margin: 0; font-weight: 800; color: #1e293b;" th:text="${m}">–ò–º—è</h5>
                                <!--                                <span class="badge" style="background: #e0f2fe; color: #0369a1; font-size: 10px;">ID: [[${m}]]</span>-->
                            </div>

                            <div style="background: #eef2ff; padding: 12px; border-radius: 12px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <b style="font-size: 15px; color: #4f46e5;"
                                       th:text="${(stats != null and stats.targetAmount != null) ? #numbers.formatDecimal(stats.targetAmount, 1, 'WHITESPACE', 2, 'POINT') + ' ÷è' : '0 ÷è'}">
                                        0 ÷è
                                    </b>
                                    <button class="btn-ghost" th:data-manager-id="${m}"
                                            onclick="openSetTargetModal(this.getAttribute('data-manager-id'))">‚úèÔ∏è
                                    </button>
                                </div>
                            </div>

                            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                                <div style="flex: 1; background: #f0fdf4; padding: 12px; border-radius: 12px;">
                                    <small style="display:block; color: #166534; font-size: 10px; font-weight: 700; text-transform: uppercase;">–ü—Ä–æ–¥–∞–Ω–æ</small>
                                    <b style="font-size: 15px; color: #166534;">
                                                        <span th:if="${stats != null and stats.totalSales != null}"
                                                              th:text="${#numbers.formatDecimal(stats.totalSales, 1, 'WHITESPACE', 2, 'POINT')} + ' ÷è'"></span>
                                        <span th:unless="${stats != null and stats.totalSales != null}">0 ÷è</span>
                                    </b>
                                </div>
                                <div style="flex: 1; background: #fff1f2; padding: 12px; border-radius: 12px;">
                                    <small style="display:block; color: #991b1b; font-size: 10px; font-weight: 700; text-transform: uppercase;">–í–æ–∑–≤—Ä–∞—Ç—ã</small>
                                    <b style="font-size: 15px; color: #991b1b;">
                                            <span th:if="${stats != null and stats.totalReturns != null}"
                                                  th:text="${#numbers.formatDecimal(stats.totalReturns, 1, 'WHITESPACE', 2, 'POINT')} + ' ÷è'"></span>
                                        <span th:unless="${stats != null and stats.totalReturns != null}">0 ÷è</span>
                                    </b>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; font-size: 11px; font-weight: 700; margin-bottom: 6px;">
                                    <span style="color: #64748b;">–ö–ü–î –ú–µ–Ω–µ–¥–∂–µ—Ä–∞</span>
                                    <span style="color: var(--accent);"
                                          th:text="${(stats != null ? stats.efficiency : 0)} + '%'">0%</span>
                                </div>
                                <div style="height: 8px; background: #f1f5f9; border-radius: 4px; overflow: hidden;">
                                    <div th:style="'height: 100%; transition: width 1s ease-in-out; background: var(--accent); width: ' + ${(stats != null ? stats.efficiency : 0)} + '%'"></div>
                                </div>
                            </div>

                            <!--                            <div style="display: flex; gap: 8px;">-->
                            <!--                                <button class="btn-ghost" style="flex: 1; padding: 8px;"-->
                            <!--                                        th:data-name="${m}"-->
                            <!--                                        onclick="showManagerInvoices(this.getAttribute('data-name'))">üí≥ –°—á–µ—Ç–∞-->
                            <!--                                </button>-->
                            <!--                                <button class="btn-ghost" style="flex: 1; padding: 8px;"-->
                            <!--                                        th:data-name="${m}"-->
                            <!--                                        onclick="showManagerReport(this.getAttribute('data-name'))">üìë –û—Ç—á–µ—Ç-->
                            <!--                                </button>-->
                            <!--                            </div>-->

                        </div>
                    </th:block>
                </div>
            </div>
        </div>


        <div id="tab-delivery" class="tab-pane">
            <!-- –°–≤–æ–¥–∫–∞ (–ì—Ä–∞–¥–∏–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω) -->
            <div class="summary-card"
                 style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border: none; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);">
                <div class="summary-item">
                    <small style="color: #1e40af;">–ì—Ä—É–∑–æ–≤ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–µ–≥–æ–¥–Ω—è</small>
                    <span style="color: #1e40af;" th:text="${invoices != null ? invoices.size() : 0}">0</span>
                </div>
                <div class="summary-item">
                    <small style="color: #1e40af;">–¢–µ–∫—É—â–∞—è —Å–º–µ–Ω–∞</small>
                    <span style="color: #1e40af;"
                          th:text="${#temporals.format(#temporals.createNow(), 'dd MMMM 2026')}"></span>
                </div>
            </div>

            <div class="logistics-grid"
                 style="display: grid; gap: 20px; margin-top: 25px;">

                <div style="background: #fff; padding: 25px; border-radius: 20px; border: 1px solid #f1f5f9; box-shadow: 0 4px 20px rgba(0,0,0,0.03); margin-bottom: 30px;">
                    <h5 style="font-weight: 800; color: #0f172a; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; font-size: 18px;">
                        <span style="background: #e0f2fe; padding: 8px; border-radius: 10px;">üöö</span> –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ
                        —Ä–µ–π—Å–∞</h5>

                    <div style="display: grid; grid-template-columns: 2fr 1.5fr 1.5fr; gap: 20px; align-items: end;">
                        <div>
                            <label style="font-size: 11px; font-weight: 700; color: #64748b; text-transform: uppercase; margin-bottom: 8px; display: block;">–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π
                                –≤–æ–¥–∏—Ç–µ–ª—å / –ú–µ–Ω–µ–¥–∂–µ—Ä</label>
                            <select id="route-manager-select" class="form-select"
                                    style="border-radius: 12px; border: 1.5px solid #e2e8f0; height: 48px; font-weight: 600; color: #1e293b;">
                                <option th:each="m : ${managers}" th:value="${m}" th:text="${m}"></option>
                            </select>
                        </div>
                        <div>
                            <label style="font-size: 11px; font-weight: 700; color: #64748b; text-transform: uppercase; margin-bottom: 8px; display: block;">–î–∞—Ç–∞
                                –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                            <input type="date" id="route-date-select" class="form-control"
                                   style="border-radius: 12px; border: 1.5px solid #e2e8f0; height: 48px; font-weight: 600;">
                        </div>
                        <button class="btn-primary"
                                style="width: 100%; background: #0284c7; height: 48px; font-weight: 700; border-radius: 12px; border: none; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 4px 12px rgba(2, 132, 199, 0.2);"
                                onclick="printRouteSheet()">
                            <span>üñ®Ô∏è</span> –ü–ï–ß–ê–¢–¨ –õ–ò–°–¢–ê
                        </button>
                    </div>
                </div>

            </div>

            <!-- –ù–û–í–ê–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –ß–ê–°–¢–¨: –¢–∞–±–ª–∏—Ü–∞ —Ç–µ–∫—É—â–µ–π –æ—á–µ—Ä–µ–¥–∏ –ø–æ–≥—Ä—É–∑–∫–∏ -->
            <div style="margin-top: 25px; background: #fff; border-radius: 16px; border: 1px solid #e2e8f0; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                <div style="padding: 15px 25px; background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
                    <h6 style="margin: 0; font-weight: 800; color: #1e293b; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px;">
                        üöö –¢–µ–∫—É—â–∞—è –æ—á–µ—Ä–µ–¥—å –ø–æ–≥—Ä—É–∑–∫–∏
                    </h6>
                </div>
                <div class="table-container" style="max-height: 300px; overflow-y: auto;">
                    <table class="table" style="margin-bottom: 0;">
                        <thead style="position: sticky; top: 0; background: #fff; z-index: 5;">
                        <tr>
                            <th style="font-size: 11px;">–ú–∞–≥–∞–∑–∏–Ω</th>
                            <th style="font-size: 11px;">–ê–≤—Ç–æ–º–æ–±–∏–ª—å</th>
                            <th style="font-size: 11px;">–°—É–º–º–∞</th>
                            <th style="font-size: 11px; text-align: center;">–°—Ç–∞—Ç—É—Å</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- –¶–∏–∫–ª –ø–æ –∏–Ω–≤–æ–π—Å–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –≥–æ—Ç–æ–≤—ã –∫ –¥–æ—Å—Ç–∞–≤–∫–µ -->
                        <tr th:each="inv : ${invoices}">
                            <td th:text="${inv.shopName}" style="font-weight: 700; color: #334155;"></td>
                            <td>
                                <!-- –ú—ã –±–µ—Ä–µ–º –Ω–æ–º–µ—Ä –º–∞—à–∏–Ω—ã –∏–∑ —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ -->
                                <span class="badge" style="background: #f1f5f9; color: #475569; padding: 5px 10px;"
                                      th:text="${inv.order != null ? (inv.order.carNumber ?: '–ù–µ —É–∫–∞–∑–∞–Ω') : '---'}"></span>

                            </td>
                            <td th:text="${#numbers.formatDecimal(inv.totalAmount, 1, 'WHITESPACE', 2, 'POINT') + ' ÷è'}"
                                style="font-weight: 600;"></td>

                            <td style="text-align: center;">
                                <span class="badge" style="background: #dcfce7; color: #166534;">–ì–û–¢–û–í –ö –û–¢–ì–†–£–ó–ö–ï</span>
                            </td>
                        </tr>
                        <!-- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç -->
                        <tr th:if="${invoices == null or #lists.isEmpty(invoices)}">
                            <td colspan="4" style="text-align: center; padding: 40px; color: #94a3b8;">
                                <i class="bi bi-truck-flatbed"
                                   style="font-size: 24px; display: block; margin-bottom: 10px;"></i>
                                –ù–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–∫–∞–∑–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ "–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ" –ø–æ–∫–∞ –Ω–µ—Ç.
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>


        <div id="tab-imports" class="tab-pane">
            <div class="glass-card" style="max-width: 600px; margin: 20px auto; text-align: center; padding: 40px;">
                <i class="bi bi-file-earmark-excel" style="font-size: 50px; color: #10b981;"></i>
                <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Excel</h3>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª .xlsx –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ —Ü–µ–Ω –Ω–∞ —Å–∫–ª–∞–¥–µ.</p>
                <button class="btn-primary" style="width: 100%;" onclick="triggerImport()">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª –∏
                    –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <hr>
                <small>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ –∏–º–ø–æ—Ä—Ç–∞ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –≤–æ –≤–∫–ª–∞–¥–∫–µ "–û–±–∑–æ—Ä"</small>
            </div>
        </div>


        <div id="tab-reports" class="tab-pane">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –°—Ç–∞—Ç—É—Å -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <h4 style="font-weight: 800; color: #1e293b; margin: 0;">üìä –¶–µ–Ω—Ç—Ä –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏</h4>
                    <p style="margin: 0; font-size: 12px; color: #64748b;">–í—ã–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏ –∏ —ç–∫—Å–ø–æ—Ä—Ç –≤
                        Excel</p>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 11px; font-weight: 700; color: #10b981; text-transform: uppercase;">
                        <span style="display:inline-block; width:8px; height:8px; background:#10b981; border-radius:50%; margin-right:5px;"></span>
                        –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —ç–∫—Å–ø–æ—Ä—Ç—É
                    </div>
                </div>
            </div>

            <!-- –ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π) -->
            <div style="background: white; padding: 20px; border-radius: 16px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05); margin-bottom: 25px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 20px; align-items: flex-end;">

                    <!-- –í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ -->
                    <div>
                        <label class="label-small" style="margin-bottom: 8px; display: block;">üìÖ –ü–ï–†–ò–û–î –í–´–ì–†–£–ó–ö–ò</label>
                        <div class="d-flex gap-2 align-items-center">
                            <input type="date" id="report-start" class="form-control form-control-sm"
                                   th:value="${orderStartDate}">
                            <span style="color: #cbd5e1;">‚Äî</span>
                            <input type="date" id="report-end" class="form-control form-control-sm"
                                   th:value="${orderEndDate}">
                        </div>
                    </div>

                    <!-- Email –∏ –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö -->
                    <div>
                        <label class="label-small" style="margin-bottom: 8px; display: block;">üìß –ü–û–õ–£–ß–ê–¢–ï–õ–¨
                            (EMAIL)</label>
                        <input type="email" id="report-email" class="form-control form-control-sm"
                               th:value="${@companySettings.getAccountantEmail()}" placeholder="accountant@company.am">
                    </div>

                    <div>
                        <label class="label-small" style="margin-bottom: 8px; display: block;">‚öôÔ∏è –§–ò–õ–¨–¢–† –î–ê–ù–ù–´–•</label>
                        <div class="d-flex gap-3"
                             style="height: 31px; align-items: center; background: #f8fafc; padding: 0 15px; border-radius: 8px; border: 1px solid #e2e8f0;">
                            <label style="font-size: 12px; margin: 0; cursor: pointer;"><input type="checkbox"
                                                                                               id="check-orders"
                                                                                               checked> –ó–∞–∫–∞–∑—ã</label>
                            <label style="font-size: 12px; margin: 0; cursor: pointer;"><input type="checkbox"
                                                                                               id="check-returns">
                                –í–æ–∑–≤—Ä–∞—Ç—ã</label>
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è -->
                    <button type="button" class="btn-primary"
                            style="height: 31px; padding: 0 15px; background: #6366f1; border: none; box-shadow: 0 2px 4px rgba(99, 102, 241, 0.2);"
                            onclick="applyReportFilters()" title="–ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø–µ—Ä–∏–æ–¥">‚ü≥
                    </button>
                </div>

                <hr style="border-color: #f1f5f9; margin: 20px 0;">

                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –∏ —Å—á–µ—Ç—á–∏–∫–∏ -->
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 10px;">
                        <!-- –ö–Ω–æ–ø–∫–∞ EXCEL –ó–∞–∫–∞–∑—ã -->
                        <button class="btn-primary"
                                style="background: #10b981; border: none; padding: 8px 20px; display: flex; align-items: center; gap: 10px;"
                                onclick="downloadExcel('orders')">
                            <i class="bi bi-file-earmark-excel"></i>
                            <span>–≠–∫—Å–ø–æ—Ä—Ç –ó–∞–∫–∞–∑–æ–≤ (<b id="btn-count-orders"
                                                      th:text="${totalOrdersCount ?: 0}">0</b>)</span>
                        </button>

                        <!-- –ö–Ω–æ–ø–∫–∞ EXCEL –í–æ–∑–≤—Ä–∞—Ç—ã -->
                        <button class="btn-primary"
                                style="background: #ef4444; border: none; padding: 8px 20px; display: flex; align-items: center; gap: 10px;"
                                onclick="downloadExcel('returns')">
                            <i class="bi bi-file-earmark-arrow-down"></i>
                            <span>–≠–∫—Å–ø–æ—Ä—Ç –í–æ–∑–≤—Ä–∞—Ç–æ–≤ (<b id="btn-count-returns" th:text="${totalReturnsCount ?: 0}">0</b>)</span>
                        </button>

                        <!-- –ö–Ω–æ–ø–∫–∞ EMAIL -->
                        <button class="btn-primary"
                                style="background: #6366f1; border: none; padding: 8px 20px; display: flex; align-items: center; gap: 10px;"
                                onclick="sendToEmail()">
                            <i class="bi bi-send"></i>
                            <span>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ—á—Ç–æ–π</span>
                        </button>
                    </div>

                    <div style="text-align: right; line-height: 1.2;">
                        <small style="color: #64748b; font-size: 11px;">–ö –≤—ã–≥—Ä—É–∑–∫–µ –¥–æ—Å—Ç—É–ø–Ω–æ:</small><br>
                        <b style="color: #1e293b; font-size: 14px;">–ò—Ç–æ–≥–æ [[${(totalOrdersCount ?: 0)}]] –æ–ø–µ—Ä–∞—Ü–∏–π</b>
                    </div>
                </div>
            </div>

            <!-- –†–µ–µ—Å—Ç—Ä –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫ (–ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å) -->
            <div style="background: white; border-radius: 16px; border: 1px solid #e2e8f0; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                <div style="padding: 15px 25px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h6 style="margin: 0; font-weight: 800; color: #1e293b;">üìù –†–µ–µ—Å—Ç—Ä –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫ —Ñ–∞–∫—Ç—É—Ä</h6>
                        <p style="margin: 0; font-size: 11px; color: #64748b;">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ
                            —Ä–µ–µ—Å—Ç—Ä–∞ –≤ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—é</p>
                    </div>
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <div style="text-align: right;">
                            <small style="color: #64748b; display: block; font-size: 10px; font-weight: 700; text-transform: uppercase;">–í—ã–±—Ä–∞–Ω–æ</small>
                            <b id="selected-count" style="color: #6366f1; font-size: 18px;">0</b>
                        </div>
                        <button class="btn-primary"
                                style="background: #6366f1; padding: 10px 25px; font-weight: 700; font-size: 13px;"
                                onclick="sendSelectedCorrections()">
                            –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–µ—Å—Ç—Ä ‚Üí
                        </button>
                    </div>
                </div>

                <div class="table-container" style="max-height: 350px; overflow-y: auto;">
                    <table class="table" style="margin: 0;">
                        <thead style="position: sticky; top: 0; background: #fff; z-index: 10; box-shadow: 0 1px 0 #e2e8f0;">
                        <tr>
                            <th style="width: 50px; text-align: center;">
                                <input type="checkbox" id="select-all-corrections" onclick="toggleAllCorrections(this)">
                            </th>
                            <th>–î–∞—Ç–∞</th>
                            <th>–ú–∞–≥–∞–∑–∏–Ω</th>
                            <th>–¢–∏–ø –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏</th>
                            <th>–°—É–º–º–∞ (÷è)</th>
                            <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                        </tr>
                        </thead>
                        <tbody id="corrections-list-body">
                        <!-- –ü–†–û–í–ï–†–ö–ê: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ Thymeleaf -->
                        <th:block th:each="r : ${returns}">
                            <tr th:if="${r.returnReason != null and (r.returnReason.name().contains('CORRECTION'))}">
                                <td><input type="checkbox" class="correction-checkbox" th:value="${r.id}"
                                           onchange="updateSelectedCount()"></td>
                                <td class="js-date-format" th:text="${r.createdAt}"></td>
                                <td th:text="${r.shopName}" style="font-weight:700;"></td>
                                <td><span class="badge bg-info" th:text="${r.returnReason.displayName}"></span></td>
                                <td class="price-down">
                            <span th:with="val=${r.totalAmount != null ? r.totalAmount.doubleValue() : 0}"
                                      th:text="${(val == 0) ? '0 ÷è' : ((val % 1 == 0) ? #numbers.formatInteger(val, 1, 'WHITESPACE') : #numbers.formatDecimal(val, 1, 'WHITESPACE', 2, 'POINT').replaceAll('0$', '')) + ' ÷è'}">
                                      </span>
                                </td>


                            </tr>
                        </th:block>
                        <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –ø—É—Å—Ç–æ -->
                        <tr th:if="${returns == null or #lists.isEmpty(returns)}">
                            <td colspan="5" style="text-align:center; padding:30px; color:#94a3b8;">–ù–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫ –∑–∞
                                –ø–µ—Ä–∏–æ–¥
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>


        <div id="tab-settings" class="tab-pane">
            <div class="container-fluid" style="max-width: 1100px; margin: 10px auto;">

                <!-- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
                <div class="d-flex align-items-center gap-3 mb-3">
                    <div style="width: 40px; height: 40px; background: var(--accent); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white;">
                        <i class="bi bi-gear-fill" style="font-size: 20px;"></i>
                    </div>
                    <div>
                        <h4 class="mb-0 fw-bolder">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h4>
                        <p class="mb-0 text-muted" style="font-size: 12px;">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Sellion ERP</p>
                    </div>
                </div>

                <form id="settings-form" onsubmit="event.preventDefault();">
                    <div class="row g-3">
                        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ -->
                        <div class="col-md-7">
                            <div class="card shadow-sm p-3 h-100" style="border-radius: 12px;">
                                <h6 class="text-primary mb-3 fw-bold" style="font-size: 13px;">
                                    <i class="bi bi-building me-1"></i> –û–†–ì–ê–ù–ò–ó–ê–¶–ò–Ø
                                </h6>
                                <div class="row g-2">
                                    <div class="col-8">
                                        <label class="label-small mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
                                        <input type="text" id="set-COMPANY_NAME" class="form-control form-control-sm"
                                               th:value="${@companySettings.getSetting('COMPANY_NAME', '’ç’•’¨’¨’´’∏’∂ ’ç’ä‘∏')}">
                                    </div>
                                    <div class="col-4">
                                        <label class="label-small mb-1">–ò–ù–ù (’Ä’é’Ä’Ä)</label>
                                        <input type="text" id="set-COMPANY_INN" class="form-control form-control-sm"
                                               th:value="${@companySettings.getSetting('COMPANY_INN', '01234567')}">
                                    </div>
                                    <div class="col-12">
                                        <label class="label-small mb-1">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å</label>
                                        <input type="text" id="set-COMPANY_ADDRESS" class="form-control form-control-sm"
                                               th:value="${@companySettings.getSetting('COMPANY_ADDRESS', '’Ä’Ä, ÷Ñ. ‘µ÷Ä÷á’°’∂')}">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ë–∞–Ω–∫ –∏ —Å–≤—è–∑—å -->
                        <div class="col-md-5">
                            <div class="card shadow-sm p-3 mb-3" style="border-radius: 12px;">
                                <h6 class="text-primary mb-3 fw-bold" style="font-size: 13px;">
                                    <i class="bi bi-bank me-1"></i> –ë–ê–ù–ö
                                </h6>
                                <div class="mb-2">
                                    <label class="label-small mb-1">–ë–∞–Ω–∫</label>
                                    <input type="text" id="set-COMPANY_BANK_NAME" class="form-control form-control-sm"
                                           th:value="${@companySettings.getSetting('COMPANY_BANK_NAME', '---')}">
                                </div>
                                <div>
                                    <label class="label-small mb-1">IBAN</label>
                                    <input type="text" id="set-COMPANY_BANK_ACCOUNT"
                                           class="form-control form-control-sm"
                                           th:value="${@companySettings.getSetting('COMPANY_BANK_ACCOUNT', '---')}">
                                </div>
                            </div>

                            <div class="card shadow-sm p-3" style="border-radius: 12px;">
                                <h6 class="text-primary mb-3 fw-bold" style="font-size: 13px;">
                                    <i class="bi bi-envelope-at me-1"></i> –°–í–Ø–ó–¨
                                </h6>
                                <label class="label-small mb-1">Email –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∞</label>
                                <input type="email" id="set-ACCOUNTANT_EMAIL" class="form-control form-control-sm"
                                       th:value="${@companySettings.getAccountantEmail()}">
                            </div>
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–Ω–∏–∑—É (—É–∑–∫–∞—è) -->
                    <div class="d-flex justify-content-between align-items-center mt-3 p-2 bg-light"
                         style="border-radius: 10px;">
                <span class="text-muted" style="font-size: 11px;">
                    –û–±–Ω–æ–≤–ª–µ–Ω–æ: <span th:text="${#temporals.format(#temporals.createNow(), 'HH:mm')}"></span>
                </span>
                        <button class="btn btn-dark px-4 py-2" onclick="saveAllSettings()" style="font-size: 14px;">
                            <i class="bi bi-check2-circle me-1"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                        </button>
                    </div>
                </form>
            </div>
        </div>


        <!-- –í–∫–ª–∞–¥–∫–∞ –û–ë–ó–û–†: –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ ADMIN -->
        <div id="tab-main" class="tab-pane"
             sec:authorize="hasRole('ADMIN')"
             th:classappend="${activeTab == 'tab-main'} ? 'active' : ''">

            <div class="modern-grid-top"
                 style="grid-template-columns: 1fr 1fr 1.2fr 0.8fr; gap: 15px; margin-bottom: 20px;">

                <!-- –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ -->
                <div class="glass-card">
                    <div style="font-size: 11px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px;">
                        <span class="dot dot-accent"></span>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫
                    </div>
                    <div style="font-size: 22px; font-weight: 800; letter-spacing: -0.5px;" id="stat-avg-check"
                         th:text="${(totalOrdersCount != null and totalOrdersCount > 0) ? #numbers.formatDecimal(totalOrdersSum / totalOrdersCount, 1, 'WHITESPACE', 2, 'POINT') + ' ÷è' : '0 ÷è'}">
                        0 ÷è
                    </div>

                    <div style="font-size: 11px; color: #64748b; margin-top: 2px;">
                        –û–∂–∏–¥–∞–µ—Ç: <span id="stat-pending-orders" style="font-weight: 700;"
                                       th:text="${pendingOrdersCount ?: 0}">0</span>
                    </div>
                </div>

                <!-- –ü—Ä–∏–±—ã–ª—å -->
                <div class="glass-card"
                     style="background: linear-gradient(to bottom right, #ffffff, #f0fdf4) !important;">
                    <div style="font-size: 11px; font-weight: 700; color: #15803d; text-transform: uppercase; margin-bottom: 4px;">
                        <span class="dot" style="background: #22c55e;"></span>–ü—Ä–∏–±—ã–ª—å
                    </div>
                    <div style="font-size: 22px; font-weight: 800; color: #15803d; letter-spacing: -0.5px;"
                         th:text="${netProfit != null ? #numbers.formatDecimal(netProfit, 1, 'WHITESPACE', 2, 'POINT') + ' ÷è' : '0 ÷è'}">
                        0 ÷è
                    </div>
                </div>

                <!-- –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã -->
                <div class="glass-card" style="align-items: center; text-align: center;">
                    <div style="font-size: 10px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; margin-bottom: 5px;">
                        –°—Ç–∞—Ç—É—Å
                    </div>
                    <div style="display: flex; align-items: center; background: #f0fdf4; padding: 6px 12px; border-radius: 12px;">
                        <span class="dot dot-online"></span>
                        <span style="font-size: 12px; font-weight: 700; color: #166534;">Online</span>
                    </div>
                    <div style="font-size: 10px; color: #94a3b8; margin-top: 4px;" sec:authentication="name">ADMIN</div>
                </div>
            </div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (Audit Log) -->
            <div class="table-container" style="flex-grow: 1;">
                <div style="padding: 12px 20px; border-bottom: 1px solid var(--border); background: #fff; position: sticky; top: 0; z-index: 10;">
                    <h5 style="margin: 0; font-weight: 700; font-size: 14px; display: flex; align-items: center; gap: 10px;">
                        –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ <span class="badge" style="font-weight: 400;">Audit Log 2026</span>
                    </h5>
                </div>
                <table class="table">
                    <thead>
                    <tr>
                        <th style="width: 150px;">–î–∞—Ç–∞</th>
                        <th style="width: 200px;">–î–µ–π—Å—Ç–≤–∏–µ</th>
                        <th>–î–µ—Ç–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏</th>
                    </tr>
                    </thead>
                    <tbody id="import-log-body">
                    <th:block th:if="${auditLogs != null and !#lists.isEmpty(auditLogs)}">
                        <tr th:each="log : ${auditLogs}">
                            <td style="color: var(--text-muted)"
                                th:text="${log.timestamp != null ? #temporals.format(log.timestamp, 'dd.MM HH:mm') : '--.--'}"></td>
                            <td>
                        <span class="badge" style="background: #eef2ff; color: #4338ca; border: none;"
                              th:text="${log.action}"></span>
                            </td>
                            <td th:text="${log.details}"></td>
                        </tr>
                    </th:block>

                    <tr th:if="${auditLogs == null or #lists.isEmpty(auditLogs)}">
                        <td colspan="3" style="text-align: center; color: #94a3b8; padding: 20px;">–û–ø–µ—Ä–∞—Ü–∏–π –ø–æ–∫–∞ –Ω–µ
                            –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="modal-order-view" class="modal">
            <div class="modal-content">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                    <h2 id="modal-title" style="margin: 0;">–î–µ—Ç–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏</h2>
                    <button onclick="closeModal('modal-order-view')"
                            style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;
                    </button>
                </div>
                <div id="order-info">
                </div>
                <div id="table-scroll-container">
                    <table class="table">


                        <thead>
                        <tr>
                            <th>–¢–æ–≤–∞—Ä</th>
                            <th>–ö–æ–ª-–≤–æ</th>
                            <th>–ü—Ä–∞–π—Å</th>
                            <th>–ü—Ä–∞–π—Å - %</th>
                            <th style="color: #f59e0b;">–ü—Ä–æ–º–æ %</th>
                            <th>–ò—Ç–æ–≥–æ</th>
                            <th>–ö–∞—Ç.</th>
                        </tr>
                        </thead>


                        <tbody id="order-items-body"></tbody>
                    </table>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto; padding-top: 20px; border-top: 2px solid #eee; flex-shrink: 0;">
                    <div id="order-total-price" style="font-size: 20px; font-weight: 800; color: var(--accent);"></div>
                    <div id="order-footer-actions" style="display: flex; gap: 10px;"></div>
                </div>
            </div>
        </div>


        <div id="modal-order-create" class="modal">
            <div class="modal-content" style="width: 650px; max-height: 90vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 id="create-modal-title" style="margin: 0;">üõí –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞</h2>
                    <button onclick="closeModal('modal-order-create')"
                            style="background:none; border:none; font-size:24px; cursor:pointer;">&times;
                    </button>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <label style="font-size: 11px; font-weight: 800; color: #64748b;">–ú–ê–ì–ê–ó–ò–ù</label>
                        <input type="text" id="new-op-shop" class="form-control"
                               list="clients-list-new"
                               onfocus="initSmartClientSearch('new-op-shop', 'clients-list-new')"
                               placeholder="–í–≤–æ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ ...">
                        <datalist id="clients-list-new">
                            <option th:each="name : ${allClientNames}" th:value="${name}" th:text="${name}"></option>
                        </datalist>
                    </div>
                    <div class="col-md-6">
                        <label style="font-size: 11px; font-weight: 800; color: #64748b;">–ú–ï–ù–ï–î–ñ–ï–†</label>
                        <select id="new-op-manager" class="form-select">
                            <option th:each="m : ${managers}" th:value="${m}" th:text="${m}"></option>
                        </select>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-4">
                        <label style="font-size: 11px; font-weight: 800; color: #64748b;">–¢–ò–ü –ù–ê–ö–õ–ê–î–ù–û–ô</label>
                        <select id="new-op-separate" class="form-select">
                            <option value="false">–û–±—â–∞—è –Ω–∞–∫–ª–∞–¥–Ω–∞—è</option>
                            <option value="true">–†–∞–∑–¥–µ–ª—å–Ω–∞—è —Ñ–∞–∫—Ç—É—Ä–∞</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label style="font-size: 11px; font-weight: 800; color: #64748b;">–ú–ï–¢–û–î –û–ü–õ–ê–¢–´</label>
                        <select id="new-op-payment" class="form-select">
                            <option th:each="pm : ${paymentMethods}" th:value="${pm}"
                                    th:text="${pm.displayName}"></option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label style="font-size: 11px; font-weight: 800; color: #6366f1;">–°–ö–ò–î–ö–ê (%)</label>
                        <input type="number" id="new-op-percent" class="form-control" value="0"
                               oninput="recalculateAllPricesByPercent()">
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <label style="font-size: 11px; font-weight: 800; color: #64748b;">–î–ê–¢–ê –î–û–°–¢–ê–í–ö–ò</label>
                        <!-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –µ—Å–ª–∏ –ø—É—Å—Ç–æ -->
                        <input type="date" id="new-op-date" class="form-control"
                               th:value="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}">
                    </div>
                    <div class="col-md-6">
                        <label style="font-size: 11px; font-weight: 800; color: #64748b;">–ù–û–ú–ï–† –ê–í–¢–û</label>
                        <input type="text" id="new-op-car" class="form-control" placeholder="–ù–∞–ø—Ä: 35XX000">
                    </div>
                </div>

                <div style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <h4 style="font-size: 14px; margin: 0;">–¢–æ–≤–∞—Ä—ã</h4>
                        <button type="button" class="btn-primary" onclick="addItemRowToOrder()">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
                        </button>
                    </div>
                    <div style="max-height: 250px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px;">
                        <table class="table" style="margin: 0;">
                            <thead style="background: #f8fafc; position: sticky; top: 0; z-index: 10;">
                            <tr style="font-size: 11px;">
                                <th>–¢–æ–≤–∞—Ä</th>
                                <th style="width: 80px;">–ö–æ–ª-–≤–æ</th>
                                <th>–¶–µ–Ω–∞</th>
                                <th>–ò—Ç–æ–≥–æ</th>
                                <th></th>
                            </tr>
                            </thead>
                            <!-- –£–ù–ò–ö–ê–õ–¨–ù–´–ô ID: manual-order-items-body -->
                            <tbody id="manual-order-items-body"></tbody>
                        </table>
                    </div>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
                    <!-- –£–ù–ò–ö–ê–õ–¨–ù–´–ô ID: manual-order-total-price -->
                    <div id="manual-order-total-price" style="font-size: 18px; font-weight: 800; color: #6366f1;">–ò—Ç–æ–≥–æ:
                        0 ÷è
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn-primary" onclick="saveNewManualOperation('order')"
                                style="background: #10b981;">–°–û–ó–î–ê–¢–¨
                        </button>
                        <button class="btn-primary" onclick="closeModal('modal-order-create')"
                                style="background: #64748b;">–û–¢–ú–ï–ù–ê
                        </button>
                    </div>
                </div>
            </div>
        </div>


        <div id="modal-client-view" class="modal">
            <div class="modal-content">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                    <h2 id="modal-client-title" style="margin: 0;">–î–µ—Ç–∞–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞</h2>
                    <button onclick="closeModal('modal-client-view')"
                            style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;
                    </button>
                </div>
                <div id="client-info">

                </div>


                <div id="table-scroll-container-client" style="flex-grow: 1; overflow-y: auto; margin: 10px 0;">
                </div>

                <div id="client-footer-actions"
                     style="display: flex; justify-content: flex-end; align-items: center; margin-top: auto; padding-top: 10px; border-top: 2px solid #eee; flex-shrink: 0; gap: 10px;">
                    <button class="btn-primary" onclick="enableClientEdit()">–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                    <button class="btn-primary" style="background:#64748b" onclick="closeModal('modal-client-view')">
                        –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>
            </div>
        </div>


        <div id="modal-client" class="modal">
            <div class="modal-content" style="width: 650px;">
                <h2 style="margin-bottom:20px;">üë§ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞</h2>
                <form th:action="@{/admin/clients/create}" method="post">
                    <div class="modal-info-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">

                        <!-- –õ–ï–í–´–ô –†–Ø–î (5 –ø—É–Ω–∫—Ç–æ–≤) -->
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div>
                                <label class="label-small">–ù–ê–ó–í–ê–ù–ò–ï –ú–ê–ì–ê–ó–ò–ù–ê</label>
                                <input type="text" name="name" class="form-control" required placeholder="–ó–û–í–ö –ü–∞–ø–∞–∑—è–Ω">
                            </div>
                            <div>
                                <label class="label-small">–í–õ–ê–î–ï–õ–ï–¶ / –ò–ü</label>
                                <input type="text" name="ownerName" class="form-control" placeholder="–§–ò–û">
                            </div>
                            <div>
                                <label class="label-small">–ò–ù–ù</label>
                                <input type="text" name="inn" class="form-control" placeholder="–ò–ù–ù">
                            </div>
                            <div>
                                <label class="label-small">–ö–ê–¢–ï–ì–û–†–ò–Ø –ö–õ–ò–ï–ù–¢–ê</label>
                                <input type="text" name="category" class="form-control"
                                       placeholder="–ù–∞–ø—Ä: –°–µ—Ç—å, –†–æ–∑–Ω–∏—Ü–∞">
                            </div>
                            <div>
                                <label class="label-small">–¢–ï–õ–ï–§–û–ù</label>
                                <input type="text" name="phone" class="form-control" placeholder="+374...">
                            </div>
                        </div>

                        <!-- –ü–†–ê–í–´–ô –†–Ø–î (5 –ø—É–Ω–∫—Ç–æ–≤) -->
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div>
                                <label class="label-small">–ú–ï–ù–ï–î–ñ–ï–†</label>
                                <select name="managerId" id="new-client-manager-id" class="form-select" required>
                                    <!-- –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∏–∑ –º–æ–¥–µ–ª–∏ -->
                                    <option th:each="m : ${managerIdList}" th:value="${m}" th:text="${m}"></option>
                                </select>
                            </div>
                            <div>
                                <label class="label-small">–î–û–õ–ì (÷è)</label>
                                <input type="number" name="debt" class="form-control" value="0" step="0.01">
                            </div>
                            <div>
                                <label class="label-small">–î–ï–ù–¨ –ú–ê–†–®–†–£–¢–ê</label>
                                <input type="text" name="routeDay" class="form-control" placeholder="–í—Ç–æ—Ä–Ω–∏–∫">
                            </div>
                            <div>
                                <label class="label-small">–ù–ê–ó–í–ê–ù–ò–ï –ë–ê–ù–ö–ê</label>
                                <input type="text" name="bankName" class="form-control" placeholder="–ê–º–µ—Ä–∏–∞ –ë–∞–Ω–∫">
                            </div>
                            <div>
                                <label class="label-small">–†–ê–°–ß–ï–¢–ù–´–ô –°–ß–ï–¢</label>
                                <input type="text" name="bankAccount" class="form-control" placeholder="15700...">
                            </div>
                        </div>
                    </div>

                    <!-- –ù–ò–ñ–ù–ò–ô –†–Ø–î (–ê–¥—Ä–µ—Å –æ—Ç–¥–µ–ª—å–Ω–æ) -->
                    <div style="margin-top:20px;">
                        <label class="label-small">–ê–î–†–ï–° –î–û–°–¢–ê–í–ö–ò</label>
                        <input type="text" name="address" class="form-control" placeholder="–£–ª–∏—Ü–∞, –¥–æ–º...">
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 25px; justify-content: flex-end;">
                        <button type="submit" class="btn-primary" style="background:#10b981; padding: 10px 25px;">
                            –°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
                        </button>
                        <button type="button" class="btn-primary" style="background:#64748b"
                                onclick="closeModal('modal-client')">–û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </form>
            </div>
        </div>


        <div id="modal-product-view" class="modal">
            <div class="modal-content">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                    <h2 id="modal-product-title" style="margin: 0;">–î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞</h2>
                    <button onclick="closeModal('modal-product-view')"
                            style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;
                    </button>
                </div>

                <div id="product-info">


                </div>

                <div id="product-footer-actions"
                     style="display: flex; justify-content: flex-end; align-items: center; margin-top: auto; padding-top: 10px; border-top: 2px solid #eee; flex-shrink: 0; gap: 10px;">
                    <button class="btn-primary" onclick="enableProductEdit()">–ò–∑–º–µ–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
                    <button class="btn-primary" style="background:#64748b" onclick="closeModal('modal-product-view')">
                        –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>
            </div>
        </div>


        <div id="modal-payment" class="modal">
            <div class="modal-content" style="width: 450px; border-top: 5px solid #10b981;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0; color: #1e293b;">üí≥ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–ø–ª–∞—Ç—ã</h3>
                    <button onclick="closeModal('modal-payment')"
                            style="background:none; border:none; font-size:24px; cursor:pointer;">&times;
                    </button>
                </div>

                <input type="hidden" id="pay-invoice-id">

                <div style="background: #f0fdf4; padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                    <small style="color: #166534; font-weight: 700; text-transform: uppercase;">–ù–æ–º–µ—Ä —Å—á–µ—Ç–∞:</small>
                    <div id="pay-invoice-display" style="font-size: 18px; font-weight: 800; color: #1e293b;">---</div>
                </div>

                <div class="mb-3">
                    <label style="font-size: 11px; font-weight: 800; color: #64748b;">–°–£–ú–ú–ê –û–ü–õ–ê–¢–´ (÷è)</label>
                    <input type="number" id="pay-amount" class="form-control form-control-lg"
                           placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É..." style="font-weight: 800; color: #10b981;">
                </div>

                <div class="mb-4">
                    <label style="font-size: 11px; font-weight: 800; color: #64748b;">–°–ü–û–°–û–ë –û–ü–õ–ê–¢–´</label>
                    <select id="pay-comment" class="form-select">
                        <option value="–ù–∞–ª–∏—á–Ω—ã–µ">–ù–∞–ª–∏—á–Ω—ã–µ</option>
                        <option value="–ü–µ—Ä–µ–≤–æ–¥">–ü–µ—Ä–µ–≤–æ–¥</option>
                    </select>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button class="btn-primary" onclick="submitPayment()"
                            style="flex: 2; background: #10b981; height: 45px; font-weight: 700;">–ü–û–î–¢–í–ï–†–î–ò–¢–¨
                    </button>
                    <button class="btn-primary" onclick="closeModal('modal-payment')"
                            style="flex: 1; background: #64748b; height: 45px;">–û–¢–ú–ï–ù–ê
                    </button>
                </div>
            </div>
        </div>


        <div id="modal-product-create-new" class="modal">
            <div class="modal-content" style="width: 700px;">
                <h2 style="margin-bottom:20px;">üì¶ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞</h2>
                <div class="modal-info-grid"
                     style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; background: #f8fafc; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0;">
                    <!-- –†—è–¥ 1 -->
                    <div><label class="label-small">–ö–ê–¢–ï–ì–û–†–ò–Ø</label><input type="text" id="new-p-cat"
                                                                            class="form-control"
                                                                            placeholder="–ù–∞–ø–∏—Ç–∫–∏..."></div>
                    <div><label class="label-small">–¶–ï–ù–ê (÷è)</label><input type="number" id="new-p-price"
                                                                           class="form-control" placeholder="0"></div>
                    <div><label class="label-small">–ö–û–î SKU (1–°)</label><input type="text" id="new-p-hsn"
                                                                               class="form-control"
                                                                               placeholder="–ö–æ–¥..."></div>
                    <div><label class="label-small">–°–†–û–ö –ì–û–î–ù–û–°–¢–ò</label><input type="date" id="new-p-expiry"
                                                                                class="form-control"></div>

                    <!-- –†—è–¥ 2 -->
                    <div style="grid-column: span 1;"><label class="label-small">–ù–ê–ó–í–ê–ù–ò–ï</label><input type="text"
                                                                                                        id="new-p-name"
                                                                                                        class="form-control"
                                                                                                        placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                    </div>
                    <div><label class="label-small">–û–°–¢–ê–¢–û–ö</label><input type="number" id="new-p-qty"
                                                                          class="form-control" value="0"></div>
                    <div><label class="label-small">–®–¢–†–ò–•-–ö–û–î</label><input type="text" id="new-p-code"
                                                                            class="form-control" placeholder="000000">
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <div style="flex: 1;"><label class="label-small">–£–ü–ê–ö.</label><input type="number"
                                                                                             id="new-p-box"
                                                                                             class="form-control"
                                                                                             value="1"></div>
                        <div style="flex: 1;"><label class="label-small">–ï–î.</label>
                            <select id="new-p-unit" class="form-select">
                                <option value="—à—Ç">—à—Ç</option>
                                <option value="–∫–≥">–∫–≥</option>
                                <option value="–∫–æ—Ä">–∫–æ—Ä</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 25px; justify-content: flex-end;">
                    <button class="btn-primary" onclick="submitCreateProduct()"
                            style="background:#10b981; padding: 10px 30px;">–°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä
                    </button>
                    <button class="btn-primary" style="background:#64748b"
                            onclick="closeModal('modal-product-create-new')">–û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>


        <div id="modal-set-target" class="modal">
            <div class="modal-content" style="width: 400px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ü–µ–ª—å –ø—Ä–æ–¥–∞–∂</h3>
                    <button onclick="closeModal('modal-set-target')"
                            style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;
                    </button>
                </div>

                <p>–ú–µ–Ω–µ–¥–∂–µ—Ä: <b id="target-manager-name"></b></p>
                <label>–°—É–º–º–∞ —Ü–µ–ª–∏ (÷è)</label>
                <input type="number" id="target-amount-input" class="form-control">

                <div style="margin-top:20px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="btn-primary" onclick="saveTargetSales()" style="background:#10b981;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                    <button class="btn-primary" style="background:#64748b;" onclick="closeModal('modal-set-target')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>


        <div id="tab-users" class="tab-pane">
            <div class="d-flex justify-content-between align-items-center mb-4" style="gap: 20px;">
                <div class="search-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-users"
                           onkeyup="filterTable('search-users', 'users-table-body')"
                           placeholder="–ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤..."
                           class="form-control w-25">
                </div>
                <button class="btn-primary" onclick="openCreateUserModal()">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                </button>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th style="width: 50px;"></th> <!-- –î–ª—è –∞–≤–∞—Ç–∞—Ä–∞ -->
                        <th>–õ–æ–≥–∏–Ω</th>
                        <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫ (–§–ò–û)</th>
                        <th>–£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞</th>
                        <th style="width: 150px; text-align: right;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th>
                    </tr>
                    </thead>
                    <tbody id="users-table-body">
                    <tr th:each="u : ${users}" th:onclick="|openUserDetailsModal('${u.id}')|" class="cursor-pointer">
                        <td>
                            <div class="user-avatar" th:text="${#strings.substring(u.fullName,0,1)}">A</div>
                        </td>
                        <td th:text="${u.username}" style="font-weight:600; color: var(--accent);"></td>
                        <td>
                            <div th:text="${u.fullName}" style="font-weight: 700; font-size: 13px;"></div>
                            <div style="font-size: 11px; color: var(--text-muted);">–ê–∫—Ç–∏–≤–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ</div>
                        </td>
                        <td>
                    <span th:class="'role-badge ' + (${u.role == 'ADMIN' ? 'role-admin' : 'role-user'})"
                          th:text="${u.role}">
                    </span>
                        </td>
                        <td onclick="event.stopPropagation()" style="text-align: right;">
                            <button class="btn-air btn-sm"
                                    th:onclick="'event.stopPropagation(); resetPassword(' + ${u.id} + ')'"
                                    title="–°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å">
                                <i class="fas fa-key"></i> –°–±—Ä–æ—Å
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="modal-user-create" class="modal">
            <div class="modal-content" style="width: 500px;">
                <h2 style="margin-bottom:20px;">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h2>
                <div class="modal-info-row">
                    <div style="flex:1">
                        <label>–õ–æ–≥–∏–Ω (Username)</label><input type="text" id="new-u-username"
                                                              placeholder="op1, acc1, boss">
                        <label>–ü–æ–ª–Ω–æ–µ –§–ò–û</label><input type="text" id="new-u-fullname"
                                                        placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
                    </div>
                </div>
                <div class="modal-info-row" style="margin-top:10px;">
                    <div style="flex:1">
                        <label>–†–æ–ª—å</label>
                        <select id="new-u-role">
                            <option value="OPERATOR">–û–ø–µ—Ä–∞—Ç–æ—Ä</option>
                            <option value="ACCOUNTANT">–ë—É—Ö–≥–∞–ª—Ç–µ—Ä</option>
                            <option value="ADMIN">–ê–¥–º–∏–Ω</option>
                        </select>
                        <label>–ü–∞—Ä–æ–ª—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é '1111')</label>
                        <input type="text" id="new-u-password" value="1111">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 25px; justify-content: flex-end;">
                    <button class="btn-primary" onclick="submitCreateUser()" style="background:#10b981">–°–æ–∑–¥–∞—Ç—å
                        —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                    </button>
                    <button class="btn-primary" style="background:#64748b" onclick="closeModal('modal-user-create')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>


        <div id="modal-inventory" class="modal">
            <div class="modal-content" style="width: 450px;">
                <h2 style="margin-bottom: 20px;">‚öñÔ∏è –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è —Å–∫–ª–∞–¥–∞</h2>
                <input type="hidden" id="inv-product-id">

                <div class="modal-info-row">
                    <div>
                        <label>–¢–æ–≤–∞—Ä</label>
                        <b id="inv-product-name" style="display: block; padding-top: 8px;">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</b>
                    </div>
                </div>

                <div class="modal-info-row" style="margin-top: 10px;">
                    <div>
                        <label>–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫ –Ω–∞ –ø–æ–ª–∫–µ (—à—Ç.)</label>
                        <input type="number" id="inv-actual-qty" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ">
                    </div>
                </div>

                <div class="modal-info-row" style="margin-top: 10px;">
                    <div>
                        <label>–ü—Ä–∏—á–∏–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏</label>
                        <input type="text" id="inv-reason" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ë–æ–π —Ç–æ–≤–∞—Ä–∞ / –ò–∑–ª–∏—à–∫–∏">
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 25px; justify-content: flex-end;">
                    <button class="btn-primary" onclick="submitInventoryAdjustment()" style="background:#10b981">
                        –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                    </button>
                    <button class="btn-primary" style="background:#64748b" onclick="closeModal('modal-inventory')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>

        <!-- –°–û–í–†–ï–ú–ï–ù–ù–´–ô –ü–†–ï–î–ß–ï–ö –ê–ö–¶–ò–ô -->
        <div id="promo-checker-overlay"
             style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(4px); z-index: 20000; align-items: center; justify-content: center; animation: fadeIn 0.2s ease;">
            <div style="width: 380px; background: white; border-radius: 20px; padding: 24px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); border: 1px solid #e2e8f0; animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="width: 50px; height: 50px; background: #fff7ed; border-radius: 14px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; color: #f97316; font-size: 24px;">
                        üî•
                    </div>
                    <h3 style="margin: 0; color: #1e293b; font-size: 18px; font-weight: 800;">–ù–∞—à–ª–∏ –∞–∫—Ü–∏–∏!</h3>
                    <p style="margin: 4px 0 0; color: #64748b; font-size: 13px;">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–ø–µ—Ü. —Ü–µ–Ω—ã –¥–ª—è –∑–∞–∫–∞–∑–∞?</p>
                </div>

                <div id="promo-list-container"
                     style="max-height: 220px; overflow-y: auto; margin-bottom: 20px; padding-right: 4px;">
                    <!-- –°—é–¥–∞ –≤—Å—Ç–∞–≤–∏–º –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∞–∫—Ü–∏–π -->
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button id="promo-skip-btn"
                            style="background: #f1f5f9; color: #64748b; border: none; padding: 12px; border-radius: 12px; font-weight: 600; cursor: pointer; transition: 0.2s;">
                        –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å
                    </button>
                    <button id="promo-apply-btn"
                            style="background: #6366f1; color: white; border: none; padding: 12px; border-radius: 12px; font-weight: 600; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.4);">
                        –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>


        <dialog id="confirm-modal" class="confirm-modal-image-style">
            <div class="confirm-modal-content">
                <h3 id="confirm-title" class="confirm-title-image-style">–£–¥–∞–ª–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç?</h3>
                <p id="confirm-text" class="confirm-text-image-style">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –≤–æ–∑–≤—Ä–∞—Ç?</p>

                <div class="confirm-actions-image-style">
                    <button class="btn-primary btn-danger" id="confirm-yes">–î–∞</button>
                    <button class="btn-primary btn-secondary" id="confirm-no">–ù–µ—Ç</button>
                </div>
            </div>
        </dialog>

        <div id="toast-container"></div>


        <script th:src="@{/js/sockjs.min.js}"></script>
        <script th:src="@{/js/stomp.min.js}"></script>


        <script th:inline="javascript">
            const ordersData = /*[[${orders}]]*/ [] ?? [];
            const returnsData = /*[[${returns}]]*/ [] ?? [];
            const productsData = /*[[${products}]]*/ [] ?? [];
            const clientsData = /*[[${clients}]]*/ [] ?? [];
            const usersData = /*[[${users}]]*/ [] ?? [];
            const fullManagersList = /*[[${managers}]]*/ [] ?? [];

            const paymentMethods = /*[[${paymentMethods}]]*/ [] ?? [];
            const returnReasons = /*[[${returnReasons}]]*/ [] ?? [];

            console.log("ERP System 2026 initialized. Data status: OK");
        </script>


        <script th:src="@{/js/script.js}"></script>

        <iframe id="printFrame" name="printFrame" style="display:none;"></iframe>
    </div>
</div>
<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>


</body>

</html>